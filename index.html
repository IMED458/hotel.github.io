<!DOCTYPE html>
<html lang="ka">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè® ·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·É° ·Éõ·Éê·É†·Éó·Éï·Éò·É° ·É°·Éò·É°·É¢·Éî·Éõ·Éê</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #64748b;
            --success: #16a34a;
            --warning: #d97706;
            --danger: #dc2626;
            --light: #f8fafc;
            --dark: #0f172a;
            --border: #e2e8f0;
            --accent: #0ea5e9;
            --gradient: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
            --calendar-bg: #ffffff;
            --calendar-header: #f1f5f9;
            --calendar-border: #cbd5e1;
            --reserved: #fee2e2;
            --reserved-border: #ef4444;
            --checkedin: #dbeafe;
            --checkedin-border: #3b82f6;
            --checkout: #fee2e2;
            --checkout-border: #ef4444;
            --day-width: 42px;
        }
        body { font-family: 'Inter', sans-serif; background: #f5f7fb; color: var(--dark); line-height: 1.55; }
        .container { max-width: 1440px; margin: 0 auto; padding: 24px; }

        /* Sidebar layout removed (revert to top tabs) */

        /* Login */
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: var(--gradient); }
        .login-box { background: white; padding: 48px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); width: 100%; max-width: 420px; transform: translateY(0); transition: transform 0.3s ease; }
        .login-box:hover { transform: translateY(-5px); }
        .login-box h1 { text-align: center; margin-bottom: 32px; color: var(--primary); font-size: 32px; display: flex; align-items: center; justify-content: center; gap: 8px; }

        /* Header */
        .header { background: white; padding: 22px 24px; border-radius: 16px; box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06); margin-bottom: 24px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { color: var(--primary); font-size: 28px; display: flex; align-items: center; gap: 8px; }
        .user-info { display: flex; align-items: center; gap: 16px; }
        .user-info span { font-weight: 500; color: var(--secondary); }

        /* Navigation */
        .nav-tabs { display: flex; gap: 10px; margin-bottom: 24px; flex-wrap: wrap; justify-content: center; background: white; padding: 10px; border-radius: 16px; box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06); }

        /* Cards */
        .card { background: white; border-radius: 16px; padding: 22px 24px; box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06); margin-bottom: 24px; transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .card:hover { transform: translateY(-3px); }
        .card h2 { margin-bottom: 24px; color: var(--primary); font-size: 24px; }
        .card h3 { margin-bottom: 16px; color: var(--dark); font-size: 20px; }

        /* Stats */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 24px; margin-bottom: 32px; }
        .stat-card { background: #ffffff; padding: 22px; border-radius: 16px; box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06); text-align: left; transition: transform 0.2s ease, box-shadow 0.2s ease; position: relative; overflow: hidden; }
        .stat-card::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 4px; background: var(--primary); }
        .stat-card:hover { transform: scale(1.05); box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
        .stat-card .label { font-size: 14px; color: var(--secondary); margin-bottom: 8px; display: flex; align-items: center; justify-content: flex-start; gap: 8px; }
        .stat-card .value { font-size: 36px; font-weight: bold; color: var(--primary); }

        /* Forms */
        .form-group { margin-bottom: 24px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--dark); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 12px 16px; border: 2px solid var(--border); border-radius: 8px; font-size: 16px; transition: all 0.3s ease; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 24px; }

        /* Buttons */
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: 500; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #16a34a; }
        .btn-warning { background: var(--warning); color: white; }
        .btn-warning:hover { background: #ca8a04; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-secondary { background: var(--secondary); color: white; }
        .btn-secondary:hover { background: #475569; }
        .btn-group { display: flex; gap: 12px; flex-wrap: wrap; }
        .btn-block { width: 100%; }

        /* Tables */
        .table-container { overflow-x: auto; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; background: white; }
        table th, table td { padding: 16px; text-align: left; border-bottom: 1px solid var(--border); }
        table th { background: var(--calendar-header); font-weight: 600; color: var(--dark); }
        table tr:hover { background: rgba(59, 130, 246, 0.05); }

        /* Calendar */
        .calendar-wrapper { background: var(--calendar-bg); border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .calendar-header { display: flex; justify-content: space-between; align-items: center; padding: 24px; background: var(--gradient); color: white; }
        .calendar-header h2 { margin: 0; font-size: 24px; font-weight: 500; color: #ffffff; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
        .calendar-nav { display: flex; gap: 12px; }
        .calendar-nav button { padding: 8px 20px; background: rgba(255,255,255,0.2); border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; color: white; transition: all 0.3s ease; }
        .calendar-nav button:hover { background: rgba(255,255,255,0.3); }
        .calendar-controls { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: var(--calendar-header); border-bottom: 1px solid var(--calendar-border); }
        .calendar-legend { display: flex; gap: 24px; align-items: center; flex-wrap: wrap; }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--secondary); }
        .legend-color { width: 24px; height: 24px; border-radius: 6px; border: 2px solid; }
        .legend-color.available { background: white; border-color: var(--calendar-border); }
        .legend-color.reserved { background: var(--reserved); border-color: var(--reserved-border); }
        .legend-color.checkedin { background: var(--checkedin); border-color: var(--checkedin-border); }
        .legend-color.checkout { background: var(--checkout); border-color: var(--checkout-border); }

        .calendar-grid { overflow-x: auto; background: white; }
        .calendar-grid-inner { min-width: 1400px; }
        .calendar-head-row, .calendar-row { display: grid; grid-template-columns: 180px repeat(var(--days-in-month), var(--day-width)); }
        .calendar-head-row { position: sticky; top: 0; z-index: 5; background: var(--calendar-header); border-bottom: 2px solid var(--calendar-border); }
        .calendar-head-cell { padding: 12px 8px; text-align: center; font-size: 14px; font-weight: 600; color: var(--dark); border-right: 1px solid var(--calendar-border); }
        .calendar-head-cell.room { text-align: left; padding-left: 16px; position: sticky; left: 0; z-index: 6; background: var(--calendar-header); border-right: 2px solid var(--calendar-border); }
        .calendar-head-cell.weekend { background: #ffedd5; color: #ea580c; }
        .calendar-head-cell.today { background: #dbeafe; color: #1d4ed8; border-bottom: 2px solid #1d4ed8; }

        .calendar-row { position: relative; border-bottom: 1px solid var(--calendar-border); }
        .calendar-room-cell { padding: 14px 16px; font-weight: 600; color: var(--dark); background: white; border-right: 2px solid var(--calendar-border); position: sticky; left: 0; z-index: 4; display: flex; align-items: center; gap: 8px; }
        .calendar-day-cell { border-right: 1px solid var(--calendar-border); height: 48px; background: white; }
        .calendar-day-cell.today { background: #eff6ff; box-shadow: inset 0 0 0 1px #3b82f6; }
        .calendar-row:hover .calendar-day-cell { background: #f8fafc; }
        .calendar-row:hover .calendar-room-cell { background: #f8fafc; }

        .room-type-badge { display: inline-block; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; margin-left: 8px; background: rgba(59, 130, 246, 0.1); color: var(--primary); }

        .reservation-bar {
            position: absolute; top: 8px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 600; padding: 0 8px; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            overflow: hidden; white-space: nowrap; text-overflow: ellipsis; color: #111827;
            clip-path: polygon(var(--left-cut) 0, 100% 0, calc(100% - var(--right-cut)) 100%, 0 100%);
        }
        .reservation-bar.reserved { background: var(--reserved); border: 2px solid var(--reserved-border); color: #713f12; }
        .reservation-bar.checkedin { background: var(--checkedin); border: 2px solid var(--checkedin-border); color: #14532d; }
        .reservation-bar.checkout { background: var(--checkout); border: 2px solid var(--checkout-border); color: #991b1b; }

        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; overflow-y: auto; transition: opacity 0.3s ease; }
        .modal.active { display: flex; justify-content: center; align-items: center; padding: 24px; opacity: 1; }
        .modal-content { background: white; border-radius: 16px; padding: 32px; max-width: 860px; width: 100%; max-height: 90vh; overflow-y: auto; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal.active .modal-content { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-header h2 { margin: 0; color: var(--primary); }
        .close-modal { background: none; border: none; font-size: 32px; cursor: pointer; color: var(--secondary); transition: color 0.3s ease; }
        .close-modal:hover { color: var(--danger); }

        /* Reservation info modal */
        .reservation-info-modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: 12px; padding: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.25); z-index: 1001; min-width: 300px; display: none; }
        .reservation-info-modal.show { display: block; }
        .reservation-info-modal h4 { margin: 0 0 12px 0; font-size: 18px; color: var(--dark); }
        .reservation-info-modal p { margin: 4px 0; font-size: 14px; color: var(--secondary); }

        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; display: none; }
        .modal-overlay.show { display: block; }

        /* Alerts */
        .alert { padding: 16px; border-radius: 8px; margin-bottom: 24px; font-weight: 500; }
        .alert-success { background: rgba(34, 197, 94, 0.1); color: var(--success); border: 1px solid var(--success); }
        .alert-error { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: 1px solid var(--danger); }
        .alert-warning { background: rgba(234, 179, 8, 0.1); color: var(--warning); border: 1px solid var(--warning); }
        .alert-info { background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 1px solid var(--primary); }

        /* Badges */
        .badge { padding: 6px 16px; border-radius: 24px; font-size: 14px; font-weight: 500; display: inline-block; }
        .badge-reserved { background: rgba(234, 179, 8, 0.1); color: var(--warning); }
        .badge-checkedin { background: rgba(34, 197, 94, 0.1); color: var(--success); }
        .badge-checkedout { background: rgba(226, 232, 240, 0.5); color: var(--secondary); }
        .badge-cancelled { background: rgba(239, 68, 68, 0.1); color: var(--danger); }
        .badge-noshow { background: rgba(243, 244, 246, 0.5); color: var(--dark); }

        /* Accordion */
        .accordion-item { border: 1px solid var(--border); border-radius: 12px; margin-bottom: 12px; overflow: hidden; transition: all 0.3s ease; }
        .accordion-item:hover { box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .accordion-header { padding: 20px; background: var(--light); cursor: pointer; font-weight: 500; display: flex; justify-content: space-between; align-items: center; transition: background 0.3s ease; }
        .accordion-header:hover { background: #e0e7ff; }
        .accordion-content { padding: 24px; display: none; background: white; }
        .accordion-content.active { display: block; }

        /* Utilities */
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .mt-20 { margin-top: 20px; }
        .mb-20 { margin-bottom: 20px; }

        /* Responsive */
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 16px; }
            .form-row { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .calendar-controls { flex-direction: column; gap: 16px; align-items: flex-start; }
            :root { --day-width: 34px; }
        }
        /* Consent Form */
        .consent-form {
            padding: 20px;
            border: 1px solid var(--border);
            background: white;
            font-size: 14px;
        }
        .consent-form h3 {
            text-align: center;
            margin-bottom: 16px;
        }
        .consent-form p { margin-bottom: 10px; }

        .channel-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            border-radius: 999px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 14px;
        }
        .channel-status.connected {
            color: #065f46;
            background: #d1fae5;
            border: 1px solid #6ee7b7;
        }
        .channel-status.disconnected {
            color: #991b1b;
            background: #fee2e2;
            border: 1px solid #fca5a5;
        }
        .channel-log-box {
            max-height: 240px;
            overflow: auto;
            border: 1px solid var(--border);
            border-radius: 10px;
            background: #f8fafc;
        }
        .channel-log-item {
            padding: 10px 12px;
            border-bottom: 1px solid #e2e8f0;
            font-size: 13px;
            display: flex;
            gap: 10px;
        }
        .channel-log-item:last-child { border-bottom: none; }
        .channel-log-item .time { color: #64748b; min-width: 150px; }
        .channel-log-item .ok { color: #166534; font-weight: 600; }
        .channel-log-item .fail { color: #991b1b; font-weight: 600; }

        /* ===== SaaS UI Polish Overrides (visual-only) ===== */
        body { background: #f5f7fb; line-height: 1.55; }
        .header { border-radius: 16px; padding: 22px 24px; box-shadow: 0 10px 24px rgba(15,23,42,0.06); }
        .nav-tabs { border-radius: 16px; padding: 10px; box-shadow: 0 10px 24px rgba(15,23,42,0.06); }
        .nav-tabs button {
            font-weight: 600;
            font-size: 14px;
            padding: 12px 16px;
            border-radius: 12px;
            background: #ffffff;
            border: 1px solid #e2e8f0;
            color: #0f172a;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease, color 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        .nav-tabs button svg { width: 18px; height: 18px; stroke: #ffffff; stroke-width: 1.8; fill: none; }
        .nav-icon {
            width: 30px;
            height: 30px;
            border-radius: 10px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 14px rgba(15,23,42,0.12);
        }
        .nav-icon.blue { background: linear-gradient(135deg, #2563eb, #60a5fa); }
        .nav-icon.purple { background: linear-gradient(135deg, #7c3aed, #a78bfa); }
        .nav-icon.orange { background: linear-gradient(135deg, #f59e0b, #fbbf24); }
        .nav-icon.teal { background: linear-gradient(135deg, #0ea5e9, #22d3ee); }
        .nav-icon.green { background: linear-gradient(135deg, #16a34a, #34d399); }
        .nav-icon.gray { background: linear-gradient(135deg, #64748b, #94a3b8); }
        .nav-tabs button:hover {
            transform: translateY(-1px);
            background: #f1f5f9;
            box-shadow: 0 8px 18px rgba(15,23,42,0.08);
        }
        .nav-tabs button.active {
            background: rgba(37,99,235,0.12);
            color: #1e40af;
            border-color: rgba(37,99,235,0.25);
            box-shadow: inset 0 0 0 1px rgba(37,99,235,0.15);
        }

        .card { border-radius: 16px; padding: 22px 24px; box-shadow: 0 10px 24px rgba(15,23,42,0.06); }
        .stat-card { border-radius: 16px; padding: 22px; text-align: left; }
        .stat-card .label { font-size: 14px; justify-content: flex-start; }

        .form-group input,
        .form-group select,
        .form-group textarea { padding: 10px 14px; border-radius: 10px; font-size: 14px; border: 1px solid #e2e8f0; }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37,99,235,0.12); }

        .btn { padding: 10px 18px; border-radius: 12px; font-size: 14px; font-weight: 600; letter-spacing: 0.2px; }
        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 10px 24px rgba(37,99,235,0.28);
            border: 1px solid rgba(37,99,235,0.2);
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 14px 28px rgba(37,99,235,0.35); }
        .btn-secondary {
            background: #f1f5f9;
            color: #0f172a;
            box-shadow: 0 6px 14px rgba(15,23,42,0.08);
            border: 1px solid #e2e8f0;
        }
        .btn-secondary:hover { background: #e9eef6; }
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 8px 20px rgba(239,68,68,0.3);
            border: 1px solid rgba(239,68,68,0.2);
        }
        .btn-danger:hover { transform: translateY(-1px); }

        table th, table td { padding: 14px 16px; }
        table th { background: #f8fafc; color: #0f172a; }
        table tbody tr:nth-child(odd) { background: #fcfdff; }
        table tr:hover { background: #f6f8fc; }

        .reservation-info-modal { border-radius: 16px; box-shadow: 0 18px 40px rgba(15,23,42,0.18); }

        /* Calendar polish */
        .calendar-wrapper { border-radius: 18px; box-shadow: 0 12px 28px rgba(15,23,42,0.08); }
        .calendar-header { border-bottom: 1px solid rgba(255,255,255,0.15); }
        .calendar-head-cell { font-weight: 600; font-size: 13px; }
        .calendar-day-cell { transition: background 0.2s ease, box-shadow 0.2s ease; }
        .calendar-day-cell:hover { background: #eef2ff; }
        .calendar-day-cell.today { background: #e0e7ff; box-shadow: inset 0 0 0 1px #3b82f6; }
        .calendar-head-cell.today { background: #e0e7ff; color: #1d4ed8; }
        .reservation-bar {
            border-radius: 10px;
            font-size: 12px;
            letter-spacing: 0.2px;
            box-shadow: 0 6px 14px rgba(15,23,42,0.15);
        }
        .reservation-bar.reserved { background: #fee2e2; border-color: #ef4444; }
        .reservation-bar.checkedin { background: #dbeafe; border-color: #3b82f6; }
        .reservation-bar.checkout { background: #ffe4e6; border-color: #f43f5e; }

        /* ===== Design Refresh (Applied) ===== */
        * { box-sizing: border-box; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        .nav-tabs button { transition: all 0.2s; }
        .nav-tabs button:hover { background: rgba(59, 130, 246, 0.1); }
        .nav-tabs button.active {
            background: rgba(59, 130, 246, 0.15);
            color: #2563eb;
            border-right: 3px solid #2563eb;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }
        .card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.25);
        }
        .btn-primary:hover { transform: translateY(-1px); box-shadow: 0 8px 20px rgba(37, 99, 235, 0.35); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
        }
        .btn-secondary:hover { background: #e2e8f0; }

        .btn-danger {
            background: #ef4444;
            color: white;
            padding: 8px 14px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            font-size: 12px;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.25);
        }
        .btn-danger:hover { background: #dc2626; }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            outline: none;
        }
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .modal-overlay { background: rgba(0,0,0,0.5); transition: all 0.3s; }
        .modal-content { background: white; border-radius: 16px; max-width: 600px; width: 90%; max-height: 90%; overflow-y: auto; transform: scale(0.9); transition: all 0.3s; }
        .modal.active .modal-content { transform: scale(1); }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .table-container table tr { transition: all 0.2s; }
        .table-container table tr:hover { background: #f8fafc; }
    </style>
</head>
<body>
    <div id="loginContainer" class="login-container">
        <div class="login-box">
            <h1>üè® ·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·É° ·Éõ·Éê·É†·Éó·Éï·Éê</h1>
            <div id="loginAlert"></div>
            <div class="form-group">
                <label>·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò</label>
                <input type="text" id="loginUsername" value="admin">
            </div>
            <div class="form-group">
                <label>·Éû·Éê·É†·Éù·Éö·Éò</label>
                <input type="password" id="loginPassword" value="admin123">
            </div>
            <button class="btn btn-primary btn-block" onclick="login()">·É®·Éî·É°·Éï·Éö·Éê</button>
        </div>
    </div>

    <div id="appContainer" class="hidden">
        <div class="container">
            <div class="header">
                <h1>üè® ·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·É° ·Éõ·Éê·É†·Éó·Éï·Éò·É° ·É°·Éò·É°·É¢·Éî·Éõ·Éê</h1>
                <div class="user-info">
                    <span id="currentUser"></span>
                    <button class="btn btn-secondary" onclick="logout()">·Éí·Éê·É°·Éï·Éö·Éê</button>
                </div>
            </div>

            <div class="nav-tabs">
                <button class="active" onclick="showPage('dashboard', this)">
                    <span class="nav-icon blue">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="3" width="8" height="8" rx="2"></rect><rect x="13" y="3" width="8" height="8" rx="2"></rect><rect x="3" y="13" width="8" height="8" rx="2"></rect><rect x="13" y="13" width="8" height="8" rx="2"></rect></svg>
                    </span>
                    ·Éì·Éê·É®·Éë·Éù·É†·Éì·Éò
                </button>
                <button onclick="showPage('calendar', this)">
                    <span class="nav-icon purple">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="5" width="18" height="16" rx="2"></rect><line x1="3" y1="9" x2="21" y2="9"></line><line x1="8" y1="3" x2="8" y2="7"></line><line x1="16" y1="3" x2="16" y2="7"></line></svg>
                    </span>
                    ·Éô·Éê·Éö·Éî·Éú·Éì·Éê·É†·Éò
                </button>
                <button onclick="showPage('reservations', this)">
                    <span class="nav-icon orange">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M6 3h9l3 3v15a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z"></path><line x1="8" y1="10" x2="16" y2="10"></line><line x1="8" y1="14" x2="16" y2="14"></line></svg>
                    </span>
                    ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò
                </button>
                <button onclick="showPage('rooms', this)">
                    <span class="nav-icon teal">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><rect x="3" y="4" width="18" height="16" rx="2"></rect><circle cx="16" cy="12" r="1.5"></circle></svg>
                    </span>
                    ·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò
                </button>
                <button onclick="showPage('reports', this)">
                    <span class="nav-icon green">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><line x1="4" y1="20" x2="20" y2="20"></line><rect x="6" y="10" width="3" height="10" rx="1"></rect><rect x="11" y="6" width="3" height="14" rx="1"></rect><rect x="16" y="13" width="3" height="7" rx="1"></rect></svg>
                    </span>
                    ·Éê·Éú·Éí·Éê·É†·Éò·É®·Éî·Éë·Éò
                </button>
                <button onclick="showPage('settings', this)">
                    <span class="nav-icon gray">
                        <svg viewBox="0 0 24 24" aria-hidden="true"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1 1 0 0 0 .2-1l-1-1.7a7.9 7.9 0 0 0 0-1.6l1-1.7a1 1 0 0 0-.2-1l-1.6-1.6a1 1 0 0 0-1-.2l-1.7 1a7.9 7.9 0 0 0-1.6 0l-1.7-1a1 1 0 0 0-1 .2L8.4 4.8a1 1 0 0 0-.2 1l1 1.7a7.9 7.9 0 0 0 0 1.6l-1 1.7a1 1 0 0 0 .2 1l1.6 1.6a1 1 0 0 0 1 .2l1.7-1a7.9 7.9 0 0 0 1.6 0l1.7 1a1 1 0 0 0 1-.2z"></path></svg>
                    </span>
                    ·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò
                </button>
            </div>

            <div id="dashboardPage" class="page"></div>
            <div id="calendarPage" class="page hidden"></div>
            <div id="reservationsPage" class="page hidden"></div>
            <div id="roomsPage" class="page hidden"></div>
            <div id="reportsPage" class="page hidden"></div>
            <div id="settingsPage" class="page hidden"></div>
            <div id="checkinoutPage" class="page hidden"></div>
            <div id="paymentsPage" class="page hidden"></div>
            <div id="staffPage" class="page hidden"></div>
            <div id="housekeepingPage" class="page hidden"></div>
        </div>
    </div>

    <div id="reservationInfoModal" class="reservation-info-modal">
        <h4 id="infoGuestName"></h4>
        <p id="infoPhone"></p>
        <p id="infoDates"></p>
        <p id="infoTimes"></p>
        <p id="infoNights"></p>
        <p id="infoStatus"></p>
        <p id="infoTotal"></p>
        <div class="form-group">
            <label>·Éô·Éù·Éõ·Éî·Éú·É¢·Éê·É†·Éò</label>
            <textarea id="infoNotes" readonly></textarea>
        </div>
        <div class="form-group">
            <label>·Éó·Éê·Éú·ÉÆ·Éõ·Éù·Éë·Éò·É° ·Éî·Éú·Éê</label>
            <select id="consentLangInfo">
                <option value="ka">·É•·Éê·É†·Éó·É£·Éö·Éò</option>
                <option value="en">English</option>
            </select>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" id="infoCheckinBtn">·É©·Éî·É•·Éò·Éú·Éò</button>
            <button class="btn btn-danger" id="infoCheckoutBtn">·É©·Éî·É•·Éê·É£·Éó·Éò</button>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" id="editReservationBtn">·É†·Éî·Éì·Éê·É•·É¢·Éò·É†·Éî·Éë·Éê</button>
            <button class="btn btn-secondary" id="printInvoiceBtn">·Éò·Éú·Éï·Éù·Éò·É°·Éò·É° ·Éë·Éî·É≠·Éì·Éï·Éê</button>
            <button class="btn btn-secondary" id="printConsentBtn">·Éó·Éê·Éú·ÉÆ·Éõ·Éù·Éë·Éò·É° ·Éë·Éî·É≠·Éì·Éï·Éê</button>
            <button class="btn btn-secondary" onclick="closeInfoModal()">·Éì·Éê·ÉÆ·É£·É†·Éï·Éê</button>
        </div>
    </div>
    <div id="modalOverlay" class="modal-overlay" onclick="closeInfoModal()"></div>

    <div id="editReservationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>·ÉØ·Éê·Éï·É®·Éú·Éò·É° ·É†·Éî·Éì·Éê·É•·É¢·Éò·É†·Éî·Éë·Éê</h2>
                <button class="close-modal" onclick="closeModal('editReservationModal')">&times;</button>
            </div>
            <div id="editModalBody"></div>
        </div>
    </div>

    <div id="reservationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">·Éê·ÉÆ·Éê·Éö·Éò ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò</h2>
                <button class="close-modal" onclick="closeModal('reservationModal')">&times;</button>
            </div>
            <div id="modalBody"></div>
        </div>
    </div>

    <script>
        const LATE_CHECKOUT_RATE = 10; // 10 GEL per hour after 12:00
        const CHANNEL_PROVIDER_NAME = 'Channex';
        const CHANNEX_DEFAULT_BASE_URL = 'https://staging.channex.io/api/v1';

        class Storage {
            static _memory = {};
            static _available = null;
            static isAvailable() {
                if (this._available !== null) return this._available;
                try {
                    const k = '__storage_test__';
                    localStorage.setItem(k, '1');
                    localStorage.removeItem(k);
                    this._available = true;
                } catch (e) {
                    this._available = false;
                }
                return this._available;
            }
            static get(key, defaultValue = null) {
                try {
                    if (this.isAvailable()) {
                        const data = localStorage.getItem(key);
                        return data ? JSON.parse(data) : defaultValue;
                    }
                } catch (e) {
                    console.error('LocalStorage get error:', e);
                }
                return this._memory[key] !== undefined ? this._memory[key] : defaultValue;
            }
            static set(key, value) {
                try {
                    if (this.isAvailable()) {
                        localStorage.setItem(key, JSON.stringify(value));
                    }
                } catch (e) { console.error('LocalStorage set error:', e); }
                this._memory[key] = value;
            }
            static remove(key) {
                try {
                    if (this.isAvailable()) {
                        localStorage.removeItem(key);
                    }
                } catch (e) { console.error('LocalStorage remove error:', e); }
                delete this._memory[key];
            }
        }

        function initializeApp() {
            if (!Storage.get('initialized')) {
                Storage.set('users', [{ username: 'admin', password: 'admin123' }]);
                const rooms = [];
                for (let i = 101; i <= 112; i++) {
                    let type, price;
                    if (i <= 104) { type = 'Single'; price = 80; }
                    else if (i <= 108) { type = 'Double'; price = 120; }
                    else if (i <= 110) { type = 'Triple'; price = 150; }
                    else { type = 'Family'; price = 200; }
                    rooms.push({
                        id: i - 100,
                        roomNumber: String(i),
                        roomName: `Room ${i}`,
                        roomType: type,
                        basePrice: price,
                        status: 'Active',
                        cleaningStatus: 'Clean',
                        extraBedAvailable: i >= 109,
                        extraBedPrice: i >= 109 ? 30 : 0
                    });
                }
                Storage.set('rooms', rooms);

                const today = new Date();
                const reservations = [
                    {
                        id: 1,
                        guestName: '·Éí·Éò·Éù·É†·Éí·Éò ·Éõ·Éî·Éö·Éê·É´·Éî',
                        guestPhone: '555123456',
                        guestEmail: 'giorgi@mail.ge',
                        guestIdNumber: '01001000001',
                        guestCitizenship: '·É°·Éê·É•·Éê·É†·Éó·Éï·Éî·Éö·Éù',
                        guestBirthDate: '1990-01-01',
                        roomId: 1,
                        checkinDate: formatDateISO(addDays(today, -2)),
                        checkoutDate: formatDateISO(addDays(today, 1)),
                        checkinTime: '14:00',
                        checkoutTime: '12:00',
                        numGuests: 1,
                        notes: '',
                        status: 'Checked-in',
                        pricePerNight: 80,
                        advanceAmount: 0,
                        lateCheckoutHours: 0,
                        extraBed: false,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        guestName: '·Éú·Éò·Éú·Éù ·Éë·Éî·É†·Éò·É´·Éî',
                        guestPhone: '555234567',
                        guestEmail: '',
                        guestIdNumber: '01001000002',
                        guestCitizenship: '·É°·Éê·É•·Éê·É†·Éó·Éï·Éî·Éö·Éù',
                        guestBirthDate: '1992-02-02',
                        roomId: 3,
                        checkinDate: formatDateISO(addDays(today, 1)),
                        checkoutDate: formatDateISO(addDays(today, 4)),
                        checkinTime: '14:00',
                        checkoutTime: '12:00',
                        numGuests: 2,
                        notes: '',
                        status: 'Reserved',
                        pricePerNight: 80,
                        advanceAmount: 0,
                        lateCheckoutHours: 0,
                        extraBed: false,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 3,
                        guestName: '·Éì·Éê·Éï·Éò·Éó ·Éô·Éê·É™·Éò·Éê',
                        guestPhone: '555345678',
                        guestEmail: 'dato@mail.ge',
                        guestIdNumber: '01001000003',
                        guestCitizenship: '·É°·Éê·É•·Éê·É†·Éó·Éï·Éî·Éö·Éù',
                        guestBirthDate: '1985-03-03',
                        roomId: 5,
                        checkinDate: formatDateISO(addDays(today, 5)),
                        checkoutDate: formatDateISO(addDays(today, 8)),
                        checkinTime: '14:00',
                        checkoutTime: '12:00',
                        numGuests: 2,
                        notes: '',
                        status: 'Reserved',
                        pricePerNight: 120,
                        advanceAmount: 0,
                        lateCheckoutHours: 0,
                        extraBed: false,
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 4,
                        guestName: '·Éê·Éú·Éê ·Éí·Éò·Éù·É†·Éí·Éê·É´·Éî',
                        guestPhone: '555456789',
                        guestEmail: 'ana@mail.ge',
                        guestIdNumber: '01001000004',
                        guestCitizenship: '·É°·Éê·É•·Éê·É†·Éó·Éï·Éî·Éö·Éù',
                        guestBirthDate: '1995-04-04',
                        roomId: 7,
                        checkinDate: formatDateISO(addDays(today, 0)),
                        checkoutDate: formatDateISO(addDays(today, 3)),
                        checkinTime: '14:00',
                        checkoutTime: '12:00',
                        numGuests: 1,
                        notes: '',
                        status: 'Checked-in',
                        pricePerNight: 120,
                        advanceAmount: 0,
                        lateCheckoutHours: 0,
                        extraBed: false,
                        createdAt: new Date().toISOString()
                    }
                ];
                Storage.set('reservations', reservations);
                Storage.set('nextReservationId', 5);
                Storage.set('payments', []);
                Storage.set('nextPaymentId', 1);
                Storage.set('guests', []);
                Storage.set('monthlyRates', getDefaultMonthlyRates());
                Storage.set('initialized', true);
            }
            ensureOptionalStorageDefaults();
        }

        function ensureOptionalStorageDefaults() {
            if (!Storage.get('channelManagerConfig')) {
                Storage.set('channelManagerConfig', {
                    provider: CHANNEL_PROVIDER_NAME,
                    apiBaseUrl: CHANNEX_DEFAULT_BASE_URL,
                    proxyUrl: '',
                    apiKey: '',
                    propertyId: '',
                    isConnected: false,
                    connectedAt: '',
                    lastSyncAt: '',
                    autoSyncEnabled: false,
                    syncIntervalMinutes: 15
                });
            }
            if (!Array.isArray(Storage.get('channelManagerLogs'))) {
                Storage.set('channelManagerLogs', []);
            }
        }

        function getDefaultMonthlyRates() {
            const rooms = Storage.get('rooms', []);
            const types = ['Single', 'Double', 'Triple', 'Family', 'Suite'];
            const defaultByType = {};
            types.forEach(t => {
                const room = rooms.find(r => r.roomType === t);
                defaultByType[t] = room ? room.basePrice : 0;
            });
            const rates = {};
            for (let m = 1; m <= 12; m++) {
                rates[m] = { ...defaultByType };
            }
            return rates;
        }

        function getPriceForRoomDate(room, dateStr) {
            const rates = Storage.get('monthlyRates', {});
            const d = new Date(dateStr);
            const month = d.getMonth() + 1;
            const byMonth = rates[month];
            if (byMonth && byMonth[room.roomType] !== undefined) {
                return byMonth[room.roomType];
            }
            return room.basePrice;
        }

        function formatDateISO(date) {
            const d = new Date(date);
            const year = d.getFullYear();
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const day = String(d.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        function formatDateDisplay(date) {
            const d = new Date(date);
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            return `${day}/${month}/${year}`;
        }
        function addDays(date, days) {
            const result = new Date(date);
            result.setDate(result.getDate() + days);
            return result;
        }
        function calculateNights(checkin, checkout) {
            const cin = new Date(checkin);
            const cout = new Date(checkout);
            const diff = cout - cin;
            return Math.ceil(diff / (1000 * 60 * 60 * 24));
        }
        function parseTimeToMinutes(timeStr) {
            if (!timeStr || !timeStr.includes(':')) return null;
            const [h, m] = timeStr.split(':').map(Number);
            if (Number.isNaN(h) || Number.isNaN(m)) return null;
            return h * 60 + m;
        }
        function calculateLateCheckoutHours(checkoutTime) {
            const minutes = parseTimeToMinutes(checkoutTime);
            if (minutes === null) return 0;
            const diff = minutes - (12 * 60);
            return diff > 0 ? Math.ceil(diff / 60) : 0;
        }
        function findGuestByIdNumber(idNumber) {
            const guests = Storage.get('guests', []);
            return guests.find(g => g.guestIdNumber === idNumber);
        }
        function upsertGuest(guest) {
            const guests = Storage.get('guests', []);
            const idx = guests.findIndex(g => g.guestIdNumber === guest.guestIdNumber);
            if (idx === -1) {
                guests.push(guest);
            } else {
                guests[idx] = { ...guests[idx], ...guest };
            }
            Storage.set('guests', guests);
        }
        function showAlert(containerId, message, type = 'success') {
            const container = document.getElementById(containerId);
            if (container) {
                container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
                setTimeout(() => { container.innerHTML = ''; }, 3000);
            }
        }
        function isWeekend(date) {
            const d = new Date(date);
            const day = d.getDay();
            return day === 0 || day === 6;
        }

        function login() {
            initializeApp();
            const username = document.getElementById('loginUsername').value.trim();
            const password = document.getElementById('loginPassword').value;
            const users = Storage.get('users', []);
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                Storage.set('currentUser', username);
                document.getElementById('loginContainer').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                document.getElementById('currentUser').textContent = `·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò: ${username}`;
                showPage('dashboard');
            } else {
                showAlert('loginAlert', '·Éê·É†·Éê·É°·É¨·Éù·É†·Éò ·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò ·Éê·Éú ·Éû·Éê·É†·Éù·Éö·Éò', 'error');
            }
        }
        function logout() {
            Storage.remove('currentUser');
            document.getElementById('loginContainer').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
            document.getElementById('loginPassword').value = '';
        }

        function showPage(pageName, btnEl = null) {
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            document.querySelectorAll('.nav-tabs button').forEach(btn => btn.classList.remove('active'));

            const pageElement = document.getElementById(`${pageName}Page`);
            if (pageElement) pageElement.classList.remove('hidden');
            if (btnEl) btnEl.classList.add('active');

            switch (pageName) {
                case 'dashboard': renderDashboard(); break;
                case 'calendar': renderCalendar(); break;
                case 'reservations': renderReservations(); break;
                case 'rooms': renderRooms(); break;
                case 'reports': renderReports(); break;
                case 'settings': renderSettings(); break;
                case 'checkinout': renderCheckInOut(); break;
                case 'payments': renderPayments(); break;
                case 'staff': renderStaff(); break;
                case 'housekeeping': renderHousekeeping(); break;
            }

            if (pageName === 'reservations') {
                const hash = window.location.hash;
                if (hash.startsWith('#res')) {
                    const id = parseInt(hash.substring(4));
                    openReservationAccordion(id);
                    window.location.hash = '';
                }
            }
        }

        function renderDashboard() {
            const today = formatDateISO(new Date());
            const reservations = Storage.get('reservations', []);
            const rooms = Storage.get('rooms', []);
            const arrivals = reservations.filter(r => r.checkinDate === today && r.status !== 'Cancelled').length;
            const departures = reservations.filter(r => r.checkoutDate === today && r.status === 'Checked-in').length;
            const inHouse = reservations.filter(r => r.status === 'Checked-in').length;
            const checkedInRoomIds = reservations.filter(r => r.status === 'Checked-in').map(r => r.roomId);
            const available = rooms.filter(r => r.status === 'Active' && !checkedInRoomIds.includes(r.id)).length;
            const arrivalsToday = reservations.filter(r => r.checkinDate === today && r.status !== 'Cancelled');
            const departuresToday = reservations.filter(r => r.checkoutDate === today && r.status === 'Checked-in');

            let html = `
                <div class="stats-grid">
                    <div class="stat-card"><div class="label">üõ¨ ·Éì·É¶·Éî·Éï·Éê·Éú·Éì·Éî·Éö·Éò Check-in</div><div class="value">${arrivals}</div></div>
                    <div class="stat-card"><div class="label">üõ´ ·Éì·É¶·Éî·Éï·Éê·Éú·Éì·Éî·Éö·Éò Check-out</div><div class="value">${departures}</div></div>
                    <div class="stat-card"><div class="label">üè† ·Éê·Éõ·Éü·Éê·Éõ·Éê·Éì ·Éì·Éê·É°·Éê·ÉÆ·Éö·Éî·Éë·É£·Éö·Éò</div><div class="value">${inHouse}</div></div>
                    <div class="stat-card"><div class="label">üÜì ·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò ·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò</div><div class="value">${available}</div></div>
                </div>
                <div class="card">
                    <h3>·Éì·É¶·Éî·Éï·Éê·Éú·Éì·Éî·Éö·Éò Check-in</h3>
                    ${arrivalsToday.length > 0 ? `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr><th>·É°·É¢·É£·Éõ·Éê·É†·Éò</th><th>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò</th><th>·Éù·Éó·Éê·ÉÆ·Éò</th><th>·É°·É¢·Éê·É¢·É£·É°·Éò</th></tr>
                                </thead>
                                <tbody>
                                    ${arrivalsToday.map(r => {
                                        const room = rooms.find(rm => rm.id === r.roomId);
                                        return `
                                            <tr>
                                                <td>${r.guestName}</td>
                                                <td>${r.guestPhone || '-'}</td>
                                        <td>${room ? (room.roomName || room.roomNumber) : '-'}</td>
                                                <td><span class="badge badge-${r.status.toLowerCase().replace('-', '')}">${r.status}</span></td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : '<div class="alert alert-info">·Éì·É¶·Éî·É° Check-in ·Éê·É† ·Éê·É†·Éò·É°</div>'}
                </div>
                <div class="card">
                    <h3>·Éì·É¶·Éî·Éï·Éê·Éú·Éì·Éî·Éö·Éò Check-out</h3>
                    ${departuresToday.length > 0 ? `
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr><th>·É°·É¢·É£·Éõ·Éê·É†·Éò</th><th>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò</th><th>·Éù·Éó·Éê·ÉÆ·Éò</th><th>·É°·É¢·Éê·É¢·É£·É°·Éò</th></tr>
                                </thead>
                                <tbody>
                                    ${departuresToday.map(r => {
                                        const room = rooms.find(rm => rm.id === r.roomId);
                                        return `
                                            <tr>
                                                <td>${r.guestName}</td>
                                                <td>${r.guestPhone || '-'}</td>
                                        <td>${room ? (room.roomName || room.roomNumber) : '-'}</td>
                                                <td><span class="badge badge-${r.status.toLowerCase().replace('-', '')}">${r.status}</span></td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    ` : '<div class="alert alert-info">·Éì·É¶·Éî·É° Check-out ·Éê·É† ·Éê·É†·Éò·É°</div>'}
                </div>
            `;
            document.getElementById('dashboardPage').innerHTML = html;
        }

        let currentCalendarDate = new Date();
        function renderCalendar() {
            const year = currentCalendarDate.getFullYear();
            const month = currentCalendarDate.getMonth();
            const monthNames = ['·Éò·Éê·Éú·Éï·Éê·É†·Éò', '·Éó·Éî·Éë·Éî·É†·Éï·Éê·Éö·Éò', '·Éõ·Éê·É†·É¢·Éò', '·Éê·Éû·É†·Éò·Éö·Éò', '·Éõ·Éê·Éò·É°·Éò', '·Éò·Éï·Éú·Éò·É°·Éò', '·Éò·Éï·Éö·Éò·É°·Éò', '·Éê·Éí·Éï·Éò·É°·É¢·Éù', '·É°·Éî·É•·É¢·Éî·Éõ·Éë·Éî·É†·Éò', '·Éù·É•·É¢·Éù·Éõ·Éë·Éî·É†·Éò', '·Éú·Éù·Éî·Éõ·Éë·Éî·É†·Éò', '·Éì·Éî·Éô·Éî·Éõ·Éë·Éî·É†·Éò'];
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const todayStr = formatDateISO(new Date());

            const rooms = Storage.get('rooms', []);
            const reservations = Storage.get('reservations', []);

            let headerCells = '<div class="calendar-head-row" style="--days-in-month:' + daysInMonth + '">';
            headerCells += '<div class="calendar-head-cell room">·Éù·Éó·Éê·ÉÆ·Éò</div>';
            for (let day = 1; day <= daysInMonth; day++) {
                const currentDate = new Date(year, month, day);
                const isWeekendDay = isWeekend(currentDate);
                const currentDateStr = formatDateISO(currentDate);
                const isToday = currentDateStr === todayStr;
                headerCells += `<div class="calendar-head-cell ${isWeekendDay ? 'weekend' : ''} ${isToday ? 'today' : ''}">${day}</div>`;
            }
            headerCells += '</div>';

            let bodyRows = '';
            rooms.forEach(room => {
                bodyRows += `<div class="calendar-row" style="--days-in-month:${daysInMonth};">`;
                bodyRows += `<div class="calendar-room-cell">${room.roomName || room.roomNumber}<span class="room-type-badge">${room.roomType}</span></div>`;

                for (let day = 1; day <= daysInMonth; day++) {
                    const currentDate = new Date(year, month, day);
                    const currentDateStr = formatDateISO(currentDate);
                    const isToday = currentDateStr === todayStr;
                    bodyRows += `<div class="calendar-day-cell ${isToday ? 'today' : ''}" data-room-id="${room.id}" data-date="${currentDateStr}" onclick="openNewReservationModalWithDate(${room.id}, '${currentDateStr}')"></div>`;
                }

                const roomRes = reservations.filter(r => r.roomId === room.id && r.status !== 'Cancelled');
                const monthStart = new Date(year, month, 1);
                const monthEnd = new Date(year, month + 1, 0);
                roomRes.forEach(res => {
                    const checkin = new Date(res.checkinDate);
                    const checkout = new Date(res.checkoutDate);

                    if (checkout <= monthStart || checkin > monthEnd) return;

                    const startInMonth = checkin.getFullYear() === year && checkin.getMonth() === month;
                    const endInMonth = checkout.getFullYear() === year && checkout.getMonth() === month;

                    const displayStart = startInMonth ? checkin : monthStart;
                    const displayEnd = endInMonth ? checkout : new Date(year, month + 1, 1);

                    const startIndex = displayStart.getDate();
                    const endIndex = endInMonth ? displayEnd.getDate() : daysInMonth + 1;

                    const startInset = startInMonth ? 0.5 : 0;
                    const endInset = endInMonth ? 0.5 : 0;

                    const leftPx = ((startIndex - 1) + startInset) * parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--day-width'));
                    const rightPx = ((endIndex - 1) + endInset) * parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--day-width'));
                    const widthPx = Math.max(rightPx - leftPx, 8);

                    const statusClass = res.status === 'Checked-in' ? 'checkedin' : (res.status === 'Checked-out' ? 'checkout' : 'reserved');

                    const dayWidth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--day-width'));
                    const leftCut = startInset * dayWidth;
                    const rightCut = endInset * dayWidth;
                    bodyRows += `
                        <div class="reservation-bar ${statusClass}" data-reservation-id="${res.id}"
                            style="left: ${leftPx + 180}px; width: ${widthPx}px; --left-cut:${leftCut}px; --right-cut:${rightCut}px;"
                            onclick="showReservationInfo(this)">
                            ${res.guestName}
                        </div>
                    `;
                });

                bodyRows += `</div>`;
            });

            const html = `
                <div class="card">
                    <div class="calendar-wrapper">
                        <div class="calendar-header">
                            <h2>${monthNames[month]} ${year}</h2>
                            <div class="calendar-nav">
                                <button onclick="changeCalendarMonth(-1)">‚Üê ·É¨·Éò·Éú·Éê ·Éó·Éï·Éî</button>
                                <button onclick="goToToday()">·Éì·É¶·Éî·É°</button>
                                <button onclick="changeCalendarMonth(1)">·É®·Éî·Éõ·Éì·Éî·Éí·Éò ·Éó·Éï·Éî ‚Üí</button>
                            </div>
                        </div>
                        <div class="calendar-controls">
                            <div class="calendar-legend">
                                <div class="legend-item"><div class="legend-color available"></div><span>·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò</span></div>
                                <div class="legend-item"><div class="legend-color reserved"></div><span>·Éì·Éê·ÉØ·Éê·Éï·É®·Éú·Éò·Éö·Éò</span></div>
                                <div class="legend-item"><div class="legend-color checkedin"></div><span>·Éì·Éê·É°·Éê·ÉÆ·Éö·Éî·Éë·É£·Éö·Éò</span></div>
                                <div class="legend-item"><div class="legend-color checkout"></div><span>Check-out</span></div>
                            </div>
                        </div>
                        <div class="calendar-grid">
                            <div class="calendar-grid-inner">
                                ${headerCells}
                                ${bodyRows}
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <h3>·ÉÆ·Éî·Éö·Éõ·Éò·É°·Éê·É¨·Éï·Éì·Éù·Éõ·Éù·Éë·Éò·É° ·É®·Éî·Éõ·Éù·É¨·Éõ·Éî·Éë·Éê</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Check-in</label>
                            <input type="date" id="availCheckIn" value="${formatDateISO(new Date())}">
                        </div>
                        <div class="form-group">
                            <label>Check-out</label>
                            <input type="date" id="availCheckOut" value="${formatDateISO(addDays(new Date(), 1))}">
                        </div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-primary btn-block" onclick="checkAvailability()">·É®·Éî·Éõ·Éù·É¨·Éõ·Éî·Éë·Éê</button>
                        </div>
                    </div>
                    <div id="availabilityResults"></div>
                </div>
            `;
            document.getElementById('calendarPage').innerHTML = html;
        }

        function changeCalendarMonth(delta) { currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta); renderCalendar(); }
        function goToToday() { currentCalendarDate = new Date(); renderCalendar(); }

        function showReservationInfo(element) {
            const reservationId = element.getAttribute('data-reservation-id');
            if (!reservationId) return;
            const reservations = Storage.get('reservations', []);
            const reservation = reservations.find(r => r.id === parseInt(reservationId));
            if (reservation) {
                const total = getReservationFinancials(reservation.id);
                document.getElementById('infoGuestName').textContent = reservation.guestName;
                document.getElementById('infoPhone').innerHTML = reservation.guestPhone ? `üìû ${reservation.guestPhone}` : '';
                document.getElementById('infoDates').innerHTML = `üìÖ ${formatDateDisplay(reservation.checkinDate)} - ${formatDateDisplay(reservation.checkoutDate)}`;
                const cinTime = reservation.checkinTime || '14:00';
                const coutTime = reservation.checkoutTime || '12:00';
                document.getElementById('infoTimes').innerHTML = `‚è∞ Check-in: ${cinTime} | Check-out: ${coutTime}`;
                document.getElementById('infoCheckinBtn').onclick = function() {
                    setReservationStatus(reservation.id, 'Checked-in');
                };
                document.getElementById('infoCheckoutBtn').onclick = function() {
                    setReservationStatus(reservation.id, 'Checked-out');
                };
                document.getElementById('infoNights').innerHTML = `üåô ${calculateNights(reservation.checkinDate, reservation.checkoutDate)} ·É¶·Éê·Éõ·Éî`;
                document.getElementById('infoStatus').innerHTML = `<span class="badge badge-${reservation.status.toLowerCase().replace('-', '')}">${reservation.status}</span>`;
                document.getElementById('infoTotal').innerHTML = `üíµ ·ÉØ·Éê·Éõ·Éò: ${total.dueTotal}‚Çæ (·É°·É†·É£·Éö·Éò: ${total.grossTotal}‚Çæ, ·Éê·Éï·Éê·Éú·É°·Éò: ${total.advance}‚Çæ${total.lateCheckoutFee > 0 ? `, ·Éö·Éî·Éò·Éó·Éò: ${total.lateCheckoutFee}‚Çæ` : ''})`;
                document.getElementById('infoNotes').value = reservation.notes || '';
                document.getElementById('editReservationBtn').onclick = function() {
                    closeInfoModal();
                    openEditReservationModal(reservation.id);
                };
                document.getElementById('printInvoiceBtn').onclick = function() {
                    printInvoice(reservation.id);
                };
                const consentBtn = document.getElementById('printConsentBtn');
                if (consentBtn) {
                    consentBtn.onclick = function() {
                        const lang = document.getElementById('consentLangInfo')?.value || 'ka';
                        printConsent(reservation.id, lang);
                    };
                }
                document.getElementById('reservationInfoModal').classList.add('show');
                document.getElementById('modalOverlay').classList.add('show');
            }
        }
        function closeInfoModal() {
            document.getElementById('reservationInfoModal').classList.remove('show');
            document.getElementById('modalOverlay').classList.remove('show');
        }
        function setReservationStatus(reservationId, status) {
            const reservations = Storage.get('reservations', []);
            const idx = reservations.findIndex(r => r.id === reservationId);
            if (idx === -1) return;
            reservations[idx].status = status;
            if (status === 'Checked-out') {
                const rooms = Storage.get('rooms', []);
                const roomIndex = rooms.findIndex(r => r.id === reservations[idx].roomId);
                if (roomIndex !== -1) {
                    rooms[roomIndex].cleaningStatus = 'Dirty';
                    Storage.set('rooms', rooms);
                }
            }
            Storage.set('reservations', reservations);
            renderCalendar();
            renderReservations();
            showReservationInfo({ getAttribute: () => reservationId });
        }

        function openEditReservationModal(reservationId) {
            const reservations = Storage.get('reservations', []);
            const reservation = reservations.find(r => r.id === reservationId);
            const rooms = Storage.get('rooms', []);
            const room = rooms.find(r => r.id === reservation.roomId);
            if (reservation) {
                document.getElementById('editModalBody').innerHTML = `
                    <div id="editResAlert"></div>
                    <div class="form-row">
                        <div class="form-group"><label>·É°·É¢·É£·Éõ·É†·Éò·É° ·É°·Éê·ÉÆ·Éî·Éö·Éò *</label><input type="text" id="editGuestName" value="${reservation.guestName}"></div>
                        <div class="form-group"><label>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò</label><input type="text" id="editGuestPhone" value="${reservation.guestPhone || ''}"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>·Éî·Éö·É§·Éù·É°·É¢·Éê</label><input type="email" id="editGuestEmail" value="${reservation.guestEmail || ''}"></div>
                        <div class="form-group"><label>·Éû·Éò·É†·Éê·Éì·Éò ·Éú·Éù·Éõ·Éî·É†·Éò / ·Éû·Éê·É°·Éû·Éù·É†·É¢·Éò·É° ‚Ññ</label><input type="text" id="editGuestIdNumber" value="${reservation.guestIdNumber || ''}"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>·Éõ·Éù·É•·Éê·Éö·Éê·É•·Éî·Éù·Éë·Éê</label><input type="text" id="editGuestCitizenship" value="${reservation.guestCitizenship || ''}"></div>
                        <div class="form-group"><label>·Éì·Éê·Éë·Éê·Éì·Éî·Éë·Éò·É° ·Éó·Éê·É†·Éò·É¶·Éò</label><input type="date" id="editGuestBirthDate" value="${reservation.guestBirthDate || ''}"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>·É°·É¢·É£·Éõ·É†·Éî·Éë·Éò·É° ·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê</label><input type="number" id="editNumGuests" value="${reservation.numGuests}" min="1"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Check-in *</label><input type="date" id="editCheckinDate" value="${reservation.checkinDate}"></div>
                        <div class="form-group"><label>Check-out *</label><input type="date" id="editCheckoutDate" value="${reservation.checkoutDate}"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Check-in ·Éì·É†·Éù</label><input type="time" id="editCheckinTime" value="${reservation.checkinTime || '14:00'}"></div>
                        <div class="form-group"><label>Check-out ·Éì·É†·Éù</label><input type="time" id="editCheckoutTime" value="${reservation.checkoutTime || '12:00'}"></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>·Éö·Éî·Éò·Éó ·É©·Éî·É•·Éê·É£·Éó ·É°·Éê·Éê·Éó·Éî·Éë·Éò (·Éê·Éï·É¢·Éù)</label><input type="number" id="editLateCheckoutHours" value="${calculateLateCheckoutHours(reservation.checkoutTime || '12:00')}" min="0" disabled></div>
                        <div class="form-group">
                            <label>·É°·É¢·Éê·É¢·É£·É°·Éò</label>
                            <select id="editStatus">
                                <option value="Reserved" ${reservation.status === 'Reserved' ? 'selected' : ''}>Reserved</option>
                                <option value="Checked-in" ${reservation.status === 'Checked-in' ? 'selected' : ''}>Checked-in</option>
                                <option value="Checked-out" ${reservation.status === 'Checked-out' ? 'selected' : ''}>Checked-out</option>
                                <option value="Cancelled" ${reservation.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                                <option value="No-show" ${reservation.status === 'No-show' ? 'selected' : ''}>No-show</option>
                            </select>
                        </div>
                        <div class="form-group"><label>·É§·Éê·É°·Éò ·É¶·Éê·Éõ·Éî·É®·Éò (‚Çæ)</label><input type="number" id="editPricePerNight" value="${reservation.pricePerNight}" min="0" step="10"></div>
                        <div class="form-group"><label>·Éê·Éï·Éê·Éú·É°·Éò (‚Çæ)</label><input type="number" id="editAdvanceAmount" value="${reservation.advanceAmount || 0}" min="0" step="10"></div>
                    </div>
                    <div class="form-group"><label>·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê</label><textarea id="editNotes">${reservation.notes || ''}</textarea></div>
                    <div class="form-group">
                        <label>·Éî·É•·É°·É¢·É†·Éê ·Éë·Éî·Éì·Éò</label>
                        <input type="checkbox" id="editExtraBed" ${reservation.extraBed ? 'checked' : ''} ${room.extraBedAvailable ? '' : 'disabled'}>
                        ${!room.extraBedAvailable ? '<span>(·Éõ·Éò·É£·É¨·Éï·Éì·Éù·Éõ·Éî·Éö·Éò)</span>' : `<span>(${room.extraBedPrice}‚Çæ)</span>`}
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="saveEditedReservation(${reservation.id})">·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê</button>
                        <button class="btn btn-secondary" onclick="closeModal('editReservationModal')">·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê</button>
                    </div>
                `;
                document.getElementById('editReservationModal').classList.add('active');
                const editCheckoutTime = document.getElementById('editCheckoutTime');
                const editLate = document.getElementById('editLateCheckoutHours');
                const updateLate = () => { editLate.value = calculateLateCheckoutHours(editCheckoutTime.value); };
                editCheckoutTime.addEventListener('change', updateLate);
                updateLate();
            }
        }

        function saveEditedReservation(reservationId) {
            const guestName = document.getElementById('editGuestName').value.trim();
            const guestPhone = document.getElementById('editGuestPhone').value.trim();
            const guestEmail = document.getElementById('editGuestEmail').value.trim();
            const guestIdNumber = document.getElementById('editGuestIdNumber').value.trim();
            const guestCitizenship = document.getElementById('editGuestCitizenship').value.trim();
            const guestBirthDate = document.getElementById('editGuestBirthDate').value;
            const numGuests = parseInt(document.getElementById('editNumGuests').value);
            const checkinDate = document.getElementById('editCheckinDate').value;
            const checkoutDate = document.getElementById('editCheckoutDate').value;
            const checkinTime = document.getElementById('editCheckinTime').value || '14:00';
            const checkoutTime = document.getElementById('editCheckoutTime').value || '12:00';
            const status = document.getElementById('editStatus').value;
            const pricePerNight = parseFloat(document.getElementById('editPricePerNight').value);
            const advanceAmount = parseFloat(document.getElementById('editAdvanceAmount').value) || 0;
            const notes = document.getElementById('editNotes').value;
            const lateCheckoutHours = calculateLateCheckoutHours(checkoutTime);
            const extraBed = document.getElementById('editExtraBed').checked;

            if (!guestName) { showAlert('editResAlert', '·É°·Éê·ÉÆ·Éî·Éö·Éò ·Éê·É£·É™·Éò·Éö·Éî·Éë·Éî·Éö·Éò·Éê!', 'error'); return; }
            if (checkoutDate <= checkinDate) { showAlert('editResAlert', 'Check-out ·É£·Éú·Éì·Éê ·Éò·Éß·Éù·É° Check-in-·Éò·É° ·É®·Éî·Éõ·Éì·Éî·Éí!', 'error'); return; }

            const reservations = Storage.get('reservations', []);
            const index = reservations.findIndex(r => r.id === reservationId);
            if (index !== -1) {
                const oldRes = reservations[index];
                if (checkinDate !== oldRes.checkinDate || checkoutDate !== oldRes.checkoutDate) {
                    if (!checkRoomAvailability(oldRes.roomId, checkinDate, checkoutDate, reservationId)) {
                        showAlert('editResAlert', '·Éù·Éó·Éê·ÉÆ·Éò ·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò·Éê ·Éê·Éõ ·Éû·Éî·É†·Éò·Éù·Éì·Éñ·Éî!', 'error');
                        return;
                    }
                }
                reservations[index] = {
                    ...reservations[index],
                    guestName, guestPhone, guestEmail, guestIdNumber, guestCitizenship, guestBirthDate,
                    numGuests, checkinDate, checkoutDate, checkinTime, checkoutTime,
                    status, pricePerNight, advanceAmount, notes, lateCheckoutHours, extraBed
                };
                if (guestIdNumber) {
                    upsertGuest({
                        guestIdNumber,
                        guestName,
                        guestPhone,
                        guestEmail,
                        guestCitizenship,
                        guestBirthDate
                    });
                }

                if (status === 'Checked-out') {
                    const rooms = Storage.get('rooms', []);
                    const roomIndex = rooms.findIndex(r => r.id === reservations[index].roomId);
                    if (roomIndex !== -1) {
                        rooms[roomIndex].cleaningStatus = 'Dirty';
                        Storage.set('rooms', rooms);
                    }
                }

                Storage.set('reservations', reservations);
                showAlert('editResAlert', '·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éî·Éë·É£·Éö·Éò·Éê!', 'success');
                closeModal('editReservationModal');
                renderCalendar();
                renderReservations();
            }
        }

        function checkAvailability() {
            const checkin = document.getElementById('availCheckIn').value;
            const checkout = document.getElementById('availCheckOut').value;
            if (!checkin || !checkout || checkout <= checkin) {
                document.getElementById('availabilityResults').innerHTML = '<div class="alert alert-error">·Éí·Éó·ÉÆ·Éù·Éï·Éó ·Éê·Éò·É†·É©·Éò·Éù·Éó ·É°·É¨·Éù·É†·Éò ·Éó·Éê·É†·Éò·É¶·Éî·Éë·Éò</div>';
                return;
            }
            const available = getAvailableRooms(checkin, checkout);
            const rooms = Storage.get('rooms', []);
            if (available.length > 0) {
                let html = `<div class="alert alert-success">·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò·Éê ${available.length} ·Éù·Éó·Éê·ÉÆ·Éò:</div>
                    <div class="table-container"><table><thead><tr><th>·Éù·Éó·Éê·ÉÆ·Éò</th><th>·É¢·Éò·Éû·Éò</th><th>·É§·Éê·É°·Éò</th></tr></thead><tbody>`;
                available.forEach(roomId => {
                    const room = rooms.find(r => r.id === roomId);
                    if (room) {
                        html += `<tr><td>${room.roomName || room.roomNumber}</td><td>${room.roomType}</td><td>${room.basePrice}‚Çæ</td></tr>`;
                    }
                });
                html += '</tbody></table></div>';
                document.getElementById('availabilityResults').innerHTML = html;
            } else {
                document.getElementById('availabilityResults').innerHTML = '<div class="alert alert-warning">·Éó·Éê·Éï·Éò·É°·É£·É§·Éê·Éö·Éò ·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò ·Éê·É† ·Éê·É†·Éò·É° ·Éê·Éõ ·Éû·Éî·É†·Éò·Éù·Éì·Éñ·Éî</div>';
            }
        }
        function getAvailableRooms(checkin, checkout) {
            const rooms = Storage.get('rooms', []);
            const reservations = Storage.get('reservations', []);
            return rooms
                .filter(r => r.status === 'Active')
                .filter(room => !reservations.some(res =>
                    res.roomId === room.id && res.status !== 'Cancelled' && !(res.checkoutDate <= checkin || res.checkinDate >= checkout)
                ))
                .map(r => r.id);
        }
        function checkRoomAvailability(roomId, checkin, checkout, excludeReservationId = null) {
            const reservations = Storage.get('reservations', []);
            return !reservations.some(res => {
                if (excludeReservationId && res.id === excludeReservationId) return false;
                return res.roomId === roomId && res.status !== 'Cancelled' && !(res.checkoutDate <= checkin || res.checkinDate >= checkout);
            });
        }

        function renderReservations() {
            const reservations = Storage.get('reservations', []);
            const rooms = Storage.get('rooms', []);
            const statusEmojis = { 'Reserved': 'üü°', 'Checked-in': 'üü¢', 'Checked-out': '‚ö™', 'Cancelled': 'üî¥', 'No-show': '‚ö´' };
            let html = `
                <div class="card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2>·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò (${reservations.length} ·É™·Éê·Éö·Éò)</h2>
                        <button class="btn btn-success" onclick="openNewReservationModal()">+ ·Éê·ÉÆ·Éê·Éö·Éò ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò</button>
                    </div>
                    <div class="form-row mb-20">
                        <div class="form-group">
                            <label>·É°·É¢·Éê·É¢·É£·É°·Éò</label>
                            <select id="filterStatus" onchange="renderReservations()">
                                <option value="">·Éß·Éï·Éî·Éö·Éê</option>
                                <option value="Reserved">Reserved</option>
                                <option value="Checked-in">Checked-in</option>
                                <option value="Checked-out">Checked-out</option>
                                <option value="Cancelled">Cancelled</option>
                                <option value="No-show">No-show</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>·É´·Éî·Éë·Éú·Éê</label>
                            <input type="text" id="searchTerm" placeholder="·É°·Éê·ÉÆ·Éî·Éö·Éò, ·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò, ·Éù·Éó·Éê·ÉÆ·Éò..." onkeyup="renderReservations()">
                        </div>
                    </div>
            `;
            const statusFilter = document.getElementById('filterStatus') ? document.getElementById('filterStatus').value : '';
            const searchTerm = document.getElementById('searchTerm') ? document.getElementById('searchTerm').value.toLowerCase() : '';
            let filtered = reservations;
            if (statusFilter) filtered = filtered.filter(r => r.status === statusFilter);
            if (searchTerm) {
                filtered = filtered.filter(r => {
                    const room = rooms.find(rm => rm.id === r.roomId);
                    return r.guestName.toLowerCase().includes(searchTerm) ||
                        (r.guestPhone && r.guestPhone.includes(searchTerm)) ||
                        (room && (room.roomNumber.includes(searchTerm) || (room.roomName || '').toLowerCase().includes(searchTerm)));
                });
            }
            filtered.sort((a, b) => new Date(b.checkinDate) - new Date(a.checkinDate));
            filtered.forEach(res => {
                const room = rooms.find(r => r.id === res.roomId);
                const nights = calculateNights(res.checkinDate, res.checkoutDate);
                const financials = getReservationFinancials(res.id);
                html += `
                    <div class="accordion-item" id="resAccordion${res.id}">
                        <div class="accordion-header" onclick="toggleAccordion(this)">
                            <span>${statusEmojis[res.status] || ''} ${res.guestName} - ·Éù·Éó·Éê·ÉÆ·Éò ${room ? (room.roomName || room.roomNumber) : '-'} (${formatDateDisplay(res.checkinDate)} - ${formatDateDisplay(res.checkoutDate)})</span>
                            <span>‚ñº</span>
                        </div>
                        <div class="accordion-content">
                            <div id="resAlert${res.id}"></div>
                            <div class="form-row">
                                <div class="form-group"><label>·É°·É¢·É£·Éõ·É†·Éò·É° ·É°·Éê·ÉÆ·Éî·Éö·Éò *</label><input type="text" id="guestName${res.id}" value="${res.guestName}"></div>
                                <div class="form-group"><label>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò</label><input type="text" id="guestPhone${res.id}" value="${res.guestPhone || ''}"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>·Éî·Éö·É§·Éù·É°·É¢·Éê</label><input type="email" id="guestEmail${res.id}" value="${res.guestEmail || ''}"></div>
                                <div class="form-group"><label>·Éû·Éò·É†·Éê·Éì·Éò ·Éú·Éù·Éõ·Éî·É†·Éò / ·Éû·Éê·É°·Éû·Éù·É†·É¢·Éò·É° ‚Ññ</label><input type="text" id="guestIdNumber${res.id}" value="${res.guestIdNumber || ''}"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>·Éõ·Éù·É•·Éê·Éö·Éê·É•·Éî·Éù·Éë·Éê</label><input type="text" id="guestCitizenship${res.id}" value="${res.guestCitizenship || ''}"></div>
                                <div class="form-group"><label>·Éì·Éê·Éë·Éê·Éì·Éî·Éë·Éò·É° ·Éó·Éê·É†·Éò·É¶·Éò</label><input type="date" id="guestBirthDate${res.id}" value="${res.guestBirthDate || ''}"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>·É°·É¢·É£·Éõ·É†·Éî·Éë·Éò·É° ·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê</label><input type="number" id="numGuests${res.id}" value="${res.numGuests}" min="1"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Check-in *</label><input type="date" id="checkinDate${res.id}" value="${res.checkinDate}"></div>
                                <div class="form-group"><label>Check-out *</label><input type="date" id="checkoutDate${res.id}" value="${res.checkoutDate}"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>Check-in ·Éì·É†·Éù</label><input type="time" id="checkinTime${res.id}" value="${res.checkinTime || '14:00'}"></div>
                                <div class="form-group"><label>Check-out ·Éì·É†·Éù</label><input type="time" id="checkoutTime${res.id}" value="${res.checkoutTime || '12:00'}" onchange="updateLateCheckoutFromTime(${res.id})"></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label>·Éö·Éî·Éò·Éó ·É©·Éî·É•·Éê·É£·Éó ·É°·Éê·Éê·Éó·Éî·Éë·Éò (·Éê·Éï·É¢·Éù)</label><input type="number" id="lateCheckoutHours${res.id}" value="${calculateLateCheckoutHours(res.checkoutTime || '12:00')}" min="0" disabled></div>
                                <div class="form-group">
                                    <label>·Éî·É•·É°·É¢·É†·Éê ·Éë·Éî·Éì·Éò</label>
                                    <input type="checkbox" id="extraBed${res.id}" ${res.extraBed ? 'checked' : ''} ${room.extraBedAvailable ? '' : 'disabled'}>
                                    ${!room.extraBedAvailable ? '<span>(·Éõ·Éò·É£·É¨·Éï·Éì·Éù·Éõ·Éî·Éö·Éò)</span>' : `<span>(${room.extraBedPrice}‚Çæ)</span>`}
                                </div>
                                <div class="form-group">
                                    <label>·É°·É¢·Éê·É¢·É£·É°·Éò</label>
                                    <select id="status${res.id}">
                                        <option value="Reserved" ${res.status === 'Reserved' ? 'selected' : ''}>Reserved</option>
                                        <option value="Checked-in" ${res.status === 'Checked-in' ? 'selected' : ''}>Checked-in</option>
                                        <option value="Checked-out" ${res.status === 'Checked-out' ? 'selected' : ''}>Checked-out</option>
                                        <option value="Cancelled" ${res.status === 'Cancelled' ? 'selected' : ''}>Cancelled</option>
                                        <option value="No-show" ${res.status === 'No-show' ? 'selected' : ''}>No-show</option>
                                    </select>
                                </div>
                                <div class="form-group"><label>·É§·Éê·É°·Éò ·É¶·Éê·Éõ·Éî·É®·Éò (‚Çæ)</label><input type="number" id="pricePerNight${res.id}" value="${res.pricePerNight}" min="0" step="10"></div>
                                <div class="form-group"><label>·Éê·Éï·Éê·Éú·É°·Éò (‚Çæ)</label><input type="number" id="advanceAmount${res.id}" value="${res.advanceAmount || 0}" min="0" step="10"></div>
                            </div>
                            <div class="form-group"><label>·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê</label><textarea id="notes${res.id}">${res.notes || ''}</textarea></div>
                            <div class="form-row">
                                <div class="form-group"><label>·É¶·Éê·Éõ·Éî·Éî·Éë·Éò</label><input type="text" value="${nights}" disabled></div>
                                <div class="form-group"><label>·É°·É†·É£·Éö·Éò ·Éó·Éê·Éú·ÉÆ·Éê</label><input type="text" value="${financials.dueTotal}‚Çæ (·É°·É†·É£·Éö·Éò: ${financials.grossTotal}‚Çæ, ·Éê·Éï·Éê·Éú·É°·Éò: ${financials.advance}‚Çæ${financials.lateCheckoutFee > 0 ? `, ·Éö·Éî·Éò·Éó·Éò: ${financials.lateCheckoutFee}‚Çæ` : ''})" disabled></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>·Éó·Éê·Éú·ÉÆ·Éõ·Éù·Éë·Éò·É° ·Éî·Éú·Éê</label>
                                    <select id="consentLang${res.id}">
                                        <option value="ka">·É•·Éê·É†·Éó·É£·Éö·Éò</option>
                                        <option value="en">English</option>
                                    </select>
                                </div>
                            </div>
                            <div class="btn-group">
                                <button class="btn btn-primary" onclick="saveReservationFromAccordion(${res.id})">·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê</button>
                                <button class="btn btn-secondary" onclick="printInvoice(${res.id})">·Éò·Éú·Éï·Éù·Éò·É°·Éò·É° ·Éë·Éî·É≠·Éì·Éï·Éê</button>
                                <button class="btn btn-secondary" onclick="printConsent(${res.id}, document.getElementById('consentLang${res.id}').value)">·Éó·Éê·Éú·ÉÆ·Éõ·Éù·Éë·Éò·É° ·Éë·Éî·É≠·Éì·Éï·Éê</button>
                                <button class="btn btn-danger" onclick="deleteReservation(${res.id})">·É¨·Éê·É®·Éö·Éê</button>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            document.getElementById('reservationsPage').innerHTML = html;
        }

        function toggleAccordion(header) {
            const content = header.nextElementSibling;
            content.classList.toggle('active');
        }

        function openReservationAccordion(resId) {
            const acc = document.getElementById(`resAccordion${resId}`);
            if (!acc) return;
            const header = acc.querySelector('.accordion-header');
            const content = acc.querySelector('.accordion-content');
            if (!content.classList.contains('active')) content.classList.add('active');
            acc.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
        function updateLateCheckoutFromTime(resId) {
            const timeInput = document.getElementById(`checkoutTime${resId}`);
            const lateInput = document.getElementById(`lateCheckoutHours${resId}`);
            if (!timeInput || !lateInput) return;
            lateInput.value = calculateLateCheckoutHours(timeInput.value);
        }

        function openNewReservationModal() {
            const rooms = Storage.get('rooms', []);
            document.getElementById('modalTitle').textContent = '·Éê·ÉÆ·Éê·Éö·Éò ·ÉØ·Éê·Éï·É®·Éê·Éú·Éò';
            document.getElementById('modalBody').innerHTML = `
                <div id="newResAlert"></div>
                <div class="form-row">
                    <div class="form-group"><label>·É°·É¢·É£·Éõ·É†·Éò·É° ·É°·Éê·ÉÆ·Éî·Éö·Éò *</label><input type="text" id="newGuestName"></div>
                    <div class="form-group"><label>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò</label><input type="text" id="newGuestPhone"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>·Éî·Éö·É§·Éù·É°·É¢·Éê</label><input type="email" id="newGuestEmail"></div>
                    <div class="form-group"><label>·Éû·Éò·É†·Éê·Éì·Éò ·Éú·Éù·Éõ·Éî·É†·Éò / ·Éû·Éê·É°·Éû·Éù·É†·É¢·Éò·É° ‚Ññ</label><input type="text" id="newGuestIdNumber" oninput="fillGuestByIdNumber()"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>·Éõ·Éù·É•·Éê·Éö·Éê·É•·Éî·Éù·Éë·Éê</label><input type="text" id="newGuestCitizenship"></div>
                    <div class="form-group"><label>·Éì·Éê·Éë·Éê·Éì·Éî·Éë·Éò·É° ·Éó·Éê·É†·Éò·É¶·Éò</label><input type="date" id="newGuestBirthDate"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>·É°·É¢·É£·Éõ·É†·Éî·Éë·Éò·É° ·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê</label><input type="number" id="newNumGuests" value="1" min="1"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>Check-in *</label><input type="date" id="newCheckinDate" value="${formatDateISO(new Date())}"></div>
                    <div class="form-group"><label>Check-out *</label><input type="date" id="newCheckoutDate" value="${formatDateISO(addDays(new Date(), 1))}"></div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>·Éù·Éó·Éê·ÉÆ·Éò</label>
                        <select id="newRoomId">${rooms.map(r => `<option value="${r.id}">${r.roomName || r.roomNumber} (${r.roomType})</option>`).join('')}</select>
                    </div>
                    <div class="form-group"><label>·É§·Éê·É°·Éò ·É¶·Éê·Éõ·Éî·É®·Éò (‚Çæ)</label><input type="number" id="newPricePerNight" value="${rooms[0]?.basePrice || 0}" min="0" step="10"></div>
                    <div class="form-group"><label>·Éê·Éï·Éê·Éú·É°·Éò (‚Çæ)</label><input type="number" id="newAdvanceAmount" value="0" min="0" step="10"></div>
                </div>
                <div class="form-row">
                    <div class="form-group"><label>·É°·É¢·Éê·É¢·É£·É°·Éò</label>
                        <select id="newStatus"><option value="Reserved">Reserved</option><option value="Checked-in">Checked-in</option></select>
                    </div>
                    <div class="form-group"><label>·Éö·Éî·Éò·Éó ·É©·Éî·É•·Éê·É£·Éó ·É°·Éê·Éê·Éó·Éî·Éë·Éò (·Éê·Éï·É¢·Éù)</label><input type="number" id="newLateCheckoutHours" value="0" min="0" disabled></div>
                </div>
                <div class="form-group"><label>·É®·Éî·Éú·Éò·É®·Éï·Éú·Éê</label><textarea id="newNotes"></textarea></div>
                <div class="btn-group">
                    <button class="btn btn-success" onclick="createReservation()">·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê</button>
                    <button class="btn btn-secondary" onclick="closeModal('reservationModal')">·Éí·Éê·É£·É•·Éõ·Éî·Éë·Éê</button>
                </div>
            `;
            document.getElementById('reservationModal').classList.add('active');
            document.getElementById('newRoomId').addEventListener('change', (e) => {
                const room = rooms.find(r => r.id === parseInt(e.target.value));
                if (room) {
                    const dateStr = document.getElementById('newCheckinDate').value;
                    const price = dateStr ? getPriceForRoomDate(room, dateStr) : room.basePrice;
                    document.getElementById('newPricePerNight').value = price;
                }
            });
            const newLate = document.getElementById('newLateCheckoutHours');
            newLate.value = 0;
        }
        function openNewReservationModalWithDate(roomId, dateStr) {
            openNewReservationModal();
            const rooms = Storage.get('rooms', []);
            const room = rooms.find(r => r.id === roomId);
            if (room) {
                document.getElementById('newRoomId').value = roomId;
                const price = getPriceForRoomDate(room, dateStr);
                document.getElementById('newPricePerNight').value = price;
            }
            document.getElementById('newCheckinDate').value = dateStr;
            document.getElementById('newCheckoutDate').value = formatDateISO(addDays(new Date(dateStr), 1));
        }
        function fillGuestByIdNumber() {
            const idNumber = document.getElementById('newGuestIdNumber').value.trim();
            if (!idNumber) return;
            const guest = findGuestByIdNumber(idNumber);
            if (!guest) return;
            document.getElementById('newGuestName').value = guest.guestName || '';
            document.getElementById('newGuestPhone').value = guest.guestPhone || '';
            document.getElementById('newGuestEmail').value = guest.guestEmail || '';
            document.getElementById('newGuestCitizenship').value = guest.guestCitizenship || '';
            document.getElementById('newGuestBirthDate').value = guest.guestBirthDate || '';
        }

        function createReservation() {
            const guestName = document.getElementById('newGuestName').value.trim();
            const guestPhone = document.getElementById('newGuestPhone').value.trim();
            const guestEmail = document.getElementById('newGuestEmail').value.trim();
            const guestIdNumber = document.getElementById('newGuestIdNumber').value.trim();
            const guestCitizenship = document.getElementById('newGuestCitizenship').value.trim();
            const guestBirthDate = document.getElementById('newGuestBirthDate').value;
            const numGuests = parseInt(document.getElementById('newNumGuests').value) || 1;
            const checkinDate = document.getElementById('newCheckinDate').value;
            const checkoutDate = document.getElementById('newCheckoutDate').value;
            const checkinTime = '14:00';
            const checkoutTime = '12:00';
            const roomId = parseInt(document.getElementById('newRoomId').value);
            const pricePerNight = parseFloat(document.getElementById('newPricePerNight').value);
            const advanceAmount = parseFloat(document.getElementById('newAdvanceAmount').value) || 0;
            const status = document.getElementById('newStatus').value;
            const lateCheckoutHours = calculateLateCheckoutHours(checkoutTime);
            const notes = document.getElementById('newNotes').value;

            if (!guestName) { showAlert('newResAlert', '·É°·Éê·ÉÆ·Éî·Éö·Éò ·Éê·É£·É™·Éò·Éö·Éî·Éë·Éî·Éö·Éò·Éê!', 'error'); return; }
            if (checkoutDate <= checkinDate) { showAlert('newResAlert', 'Check-out ·É£·Éú·Éì·Éê ·Éò·Éß·Éù·É° Check-in-·Éò·É° ·É®·Éî·Éõ·Éì·Éî·Éí!', 'error'); return; }
            if (!checkRoomAvailability(roomId, checkinDate, checkoutDate)) { showAlert('newResAlert', '·Éù·Éó·Éê·ÉÆ·Éò ·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò·Éê ·Éê·Éõ ·Éû·Éî·É†·Éò·Éù·Éì·Éñ·Éî!', 'error'); return; }

            const reservations = Storage.get('reservations', []);
            const nextId = Storage.get('nextReservationId', 1);
            reservations.push({
                id: nextId,
                guestName,
                guestPhone,
                guestEmail,
                guestIdNumber,
                guestCitizenship,
                guestBirthDate,
                roomId,
                checkinDate,
                checkoutDate,
                checkinTime,
                checkoutTime,
                numGuests,
                notes,
                status,
                pricePerNight,
                advanceAmount,
                lateCheckoutHours,
                extraBed: false,
                createdAt: new Date().toISOString()
            });
            if (guestIdNumber) {
                upsertGuest({
                    guestIdNumber,
                    guestName,
                    guestPhone,
                    guestEmail,
                    guestCitizenship,
                    guestBirthDate
                });
            }
            Storage.set('reservations', reservations);
            Storage.set('nextReservationId', nextId + 1);
            closeModal('reservationModal');
            renderReservations();
            renderCalendar();
        }

        function saveReservationFromAccordion(resId) {
            const reservations = Storage.get('reservations', []);
            const index = reservations.findIndex(r => r.id === resId);
            if (index === -1) return;

            const guestName = document.getElementById(`guestName${resId}`).value.trim();
            const guestPhone = document.getElementById(`guestPhone${resId}`).value.trim();
            const guestEmail = document.getElementById(`guestEmail${resId}`).value.trim();
            const guestIdNumber = document.getElementById(`guestIdNumber${resId}`).value.trim();
            const guestCitizenship = document.getElementById(`guestCitizenship${resId}`).value.trim();
            const guestBirthDate = document.getElementById(`guestBirthDate${resId}`).value;
            const numGuests = parseInt(document.getElementById(`numGuests${resId}`).value);
            const checkinDate = document.getElementById(`checkinDate${resId}`).value;
            const checkoutDate = document.getElementById(`checkoutDate${resId}`).value;
            const checkinTime = document.getElementById(`checkinTime${resId}`).value || '14:00';
            const checkoutTime = document.getElementById(`checkoutTime${resId}`).value || '12:00';
            const lateCheckoutHours = calculateLateCheckoutHours(checkoutTime);
            const extraBed = document.getElementById(`extraBed${resId}`).checked;
            const status = document.getElementById(`status${resId}`).value;
            const pricePerNight = parseFloat(document.getElementById(`pricePerNight${resId}`).value);
            const advanceAmount = parseFloat(document.getElementById(`advanceAmount${resId}`).value) || 0;
            const notes = document.getElementById(`notes${resId}`).value;

            if (!guestName) { showAlert(`resAlert${resId}`, '·É°·Éê·ÉÆ·Éî·Éö·Éò ·Éê·É£·É™·Éò·Éö·Éî·Éë·Éî·Éö·Éò·Éê!', 'error'); return; }
            if (checkoutDate <= checkinDate) { showAlert(`resAlert${resId}`, 'Check-out ·É£·Éú·Éì·Éê ·Éò·Éß·Éù·É° Check-in-·Éò·É° ·É®·Éî·Éõ·Éì·Éî·Éí!', 'error'); return; }

            if (!checkRoomAvailability(reservations[index].roomId, checkinDate, checkoutDate, resId)) {
                showAlert(`resAlert${resId}`, '·Éù·Éó·Éê·ÉÆ·Éò ·Éì·Éê·Éô·Éê·Éï·Éî·Éë·É£·Éö·Éò·Éê ·Éê·Éõ ·Éû·Éî·É†·Éò·Éù·Éì·Éñ·Éî!', 'error');
                return;
            }

            reservations[index] = { ...reservations[index],
                guestName, guestPhone, guestEmail, guestIdNumber, guestCitizenship, guestBirthDate,
                numGuests, checkinDate, checkoutDate, checkinTime, checkoutTime, lateCheckoutHours,
                extraBed, status, pricePerNight, advanceAmount, notes
            };

            Storage.set('reservations', reservations);
            showAlert(`resAlert${resId}`, '·Éí·Éê·Éú·Éê·ÉÆ·Éö·Éî·Éë·É£·Éö·Éò·Éê!', 'success');
            renderCalendar();
            renderReservations();
        }

        function deleteReservation(resId) {
            if (!confirm('·Éú·Éê·Éõ·Éì·Éï·Éò·Éö·Éê·Éì ·Éí·É°·É£·É†·Éó ·ÉØ·Éê·Éï·É®·Éú·Éò·É° ·É¨·Éê·É®·Éö·Éê?')) return;
            const reservations = Storage.get('reservations', []);
            Storage.set('reservations', reservations.filter(r => r.id !== resId));
            renderReservations();
            renderCalendar();
        }

        function getReservationFinancials(resId) {
            const reservations = Storage.get('reservations', []);
            const res = reservations.find(r => r.id === resId);
            if (!res) return { nights: 0, baseTotal: 0, lateCheckoutFee: 0, grossTotal: 0, advance: 0, dueTotal: 0 };
            const nights = calculateNights(res.checkinDate, res.checkoutDate);
            const baseTotal = nights * res.pricePerNight;
            const lateHours = res.lateCheckoutHours !== undefined
                ? res.lateCheckoutHours
                : calculateLateCheckoutHours(res.checkoutTime || '12:00');
            const lateCheckoutFee = Math.max(0, lateHours || 0) * LATE_CHECKOUT_RATE;
            const grossTotal = baseTotal + lateCheckoutFee;
            const advance = Math.max(0, res.advanceAmount || 0);
            const dueTotal = Math.max(0, grossTotal - advance);
            return { nights, baseTotal, lateCheckoutFee, grossTotal, advance, dueTotal };
        }
        function printInvoice(resId) {
            const reservations = Storage.get('reservations', []);
            const rooms = Storage.get('rooms', []);
            const res = reservations.find(r => r.id === resId);
            if (!res) return;
            const room = rooms.find(r => r.id === res.roomId);
            const financials = getReservationFinancials(resId);
            const invoiceNo = `INV-${res.id}-${new Date().getTime()}`;
            const cinTime = res.checkinTime || '14:00';
            const coutTime = res.checkoutTime || '12:00';
            const lateHours = calculateLateCheckoutHours(coutTime);
            const hasLate = financials.lateCheckoutFee > 0;

            const w = window.open('', '_blank');
            if (!w) return;
            w.document.write(`
                <!DOCTYPE html>
                <html lang="ka">
                <head>
                    <meta charset="UTF-8">
                    <title>·Éò·Éú·Éï·Éù·Éò·É°·Éò ${invoiceNo}</title>
                    <style>
                        body { font-family: 'Roboto', sans-serif; padding: 32px; color: #0f172a; }
                        h1 { margin: 0 0 8px; }
                        .muted { color: #64748b; }
                        .row { display: flex; justify-content: space-between; gap: 16px; }
                        .box { border: 1px solid #e2e8f0; border-radius: 12px; padding: 16px; margin-top: 16px; }
                        table { width: 100%; border-collapse: collapse; margin-top: 12px; }
                        th, td { padding: 10px; border-bottom: 1px solid #e2e8f0; text-align: left; }
                        th { background: #f1f5f9; }
                        .total { font-size: 18px; font-weight: 700; }
                        .right { text-align: right; }
                        @media print { .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="row">
                        <div>
                            <h1>·É°·Éê·É°·É¢·É£·Éõ·É†·Éù ‚Äî ·Éò·Éú·Éï·Éù·Éò·É°·Éò</h1>
                            <div class="muted">·Éò·Éú·Éï·Éù·Éò·É°·Éò·É° ‚Ññ: ${invoiceNo}</div>
                            <div class="muted">·Éó·Éê·É†·Éò·É¶·Éò: ${formatDateDisplay(new Date())}</div>
                        </div>
                        <div class="right">
                            <div class="muted">·É°·É¢·Éê·É¢·É£·É°·Éò: ${res.status}</div>
                        </div>
                    </div>

                    <div class="box">
                        <div><strong>·É°·É¢·É£·Éõ·Éê·É†·Éò:</strong> ${res.guestName}</div>
                        <div><strong>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò:</strong> ${res.guestPhone || '-'}</div>
                        <div><strong>·Éù·Éó·Éê·ÉÆ·Éò:</strong> ${room ? (room.roomName || room.roomNumber) : '-' } (${room ? room.roomType : '-'})</div>
                        <div><strong>·Éó·Éê·É†·Éò·É¶·Éî·Éë·Éò:</strong> ${formatDateDisplay(res.checkinDate)} ${cinTime} ‚Äî ${formatDateDisplay(res.checkoutDate)} ${coutTime}</div>
                    </div>

                    <div class="box">
                        <table>
                            <thead>
                                <tr>
                                    <th>·Éê·É¶·É¨·Éî·É†·Éê</th>
                                    <th class="right">·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê</th>
                                    <th class="right">·É§·Éê·É°·Éò</th>
                                    <th class="right">·ÉØ·Éê·Éõ·Éò</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>·É°·Éê·É°·É¢·É£·Éõ·É†·Éù ‚Äî ·É¶·Éê·Éõ·Éî·Éî·Éë·Éò</td>
                                    <td class="right">${financials.nights}</td>
                                    <td class="right">${res.pricePerNight}‚Çæ</td>
                                    <td class="right">${financials.baseTotal}‚Çæ</td>
                                </tr>
                                ${hasLate ? `
                                <tr>
                                    <td>·Éö·Éî·Éò·Éó ·É©·Éî·É•·Éê·É£·Éó·Éò (${lateHours} ·É°·Éó, 10‚Çæ/·É°·Éó)</td>
                                    <td class="right">${lateHours}</td>
                                    <td class="right">${LATE_CHECKOUT_RATE}‚Çæ</td>
                                    <td class="right">${financials.lateCheckoutFee}‚Çæ</td>
                                </tr>` : ``}
                                <tr>
                                    <td>·Éê·Éï·Éê·Éú·É°·Éò</td>
                                    <td class="right">1</td>
                                    <td class="right">-</td>
                                    <td class="right">-${financials.advance}‚Çæ</td>
                                </tr>
                            </tbody>
                        </table>
                        <div class="row" style="margin-top: 12px;">
                            <div></div>
                            <div class="total">·É°·É†·É£·Éö·Éò: ${financials.grossTotal}‚Çæ | ·Éê·Éï·Éê·Éú·É°·Éò: ${financials.advance}‚Çæ | ·Éì·Éê·É°·Éê·É†·É©·Éî·Éú·Éò: ${financials.dueTotal}‚Çæ</div>
                        </div>
                    </div>

                    <div class="no-print" style="margin-top: 16px;">
                        <button onclick="window.print()">·Éë·Éî·É≠·Éì·Éï·Éê</button>
                    </div>
                </body>
                </html>
            `);
            w.document.close();
            w.focus();
        }
        function printConsent(resId, lang = 'ka') {
            const reservations = Storage.get('reservations', []);
            const rooms = Storage.get('rooms', []);
            const res = reservations.find(r => r.id === resId);
            if (!res) return;
            const room = rooms.find(r => r.id === res.roomId);
            const cinTime = res.checkinTime || '14:00';
            const coutTime = res.checkoutTime || '12:00';
            const checkinDisplay = formatDateDisplay(res.checkinDate);
            const checkoutDisplay = formatDateDisplay(res.checkoutDate);
            const birthDisplay = res.guestBirthDate ? formatDateDisplay(res.guestBirthDate) : '';

            const w = window.open('', '_blank');
            if (!w) return;
            const isKa = lang === 'ka';
            const title = isKa ? '·É°·É¢·É£·Éõ·É†·Éò·É° ·É†·Éî·Éí·Éò·É°·É¢·É†·Éê·É™·Éò·Éò·É°·Éê ·Éì·Éê ·Éó·Éê·Éú·ÉÆ·Éõ·Éù·Éë·Éò·É° ·É§·Éù·É†·Éõ·Éê' : 'Guest Registration and Consent Form';
            const consentText = isKa ? `
                <p><strong>·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·É° ·Éì·Éê·É°·Éê·ÉÆ·Éî·Éö·Éî·Éë·Éê:</strong> ______________________________</p>
                <p><strong>·Éõ·Éò·É°·Éê·Éõ·Éê·É†·Éó·Éò:</strong> ________________________________________</p>
                <p><strong>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò / ·Éî·Éö·É§·Éù·É°·É¢·Éê:</strong> _______________________________</p>
                <h4>·É°·É¢·É£·Éõ·É†·Éò·É° ·Éò·Éú·É§·Éù·É†·Éõ·Éê·É™·Éò·Éê</h4>
                <p><strong>·É°·Éê·ÉÆ·Éî·Éö·Éò, ·Éí·Éï·Éê·É†·Éò:</strong> ${res.guestName || '___________________________________'}</p>
                <p><strong>·Éû·Éò·É†·Éê·Éì·Éò ·Éú·Éù·Éõ·Éî·É†·Éò / ·Éû·Éê·É°·Éû·Éù·É†·É¢·Éò·É° ‚Ññ:</strong> ${res.guestIdNumber || '______________________________'}</p>
                <p><strong>·Éõ·Éù·É•·Éê·Éö·Éê·É•·Éî·Éù·Éë·Éê:</strong> ${res.guestCitizenship || '______________________________'}</p>
                <p><strong>·Éì·Éê·Éë·Éê·Éì·Éî·Éë·Éò·É° ·Éó·Éê·É†·Éò·É¶·Éò:</strong> ${birthDisplay || '______________________________'}</p>
                <p><strong>·É¢·Éî·Éö·Éî·É§·Éù·Éú·Éò·É° ·Éú·Éù·Éõ·Éî·É†·Éò:</strong> ${res.guestPhone || '______________________________'}</p>
                <p><strong>·Éî·Éö·É§·Éù·É°·É¢·Éê (·Éê·É†·Éê·É°·Éê·Éï·Éê·Éö·Éì·Éî·Éë·É£·Éö·Éù):</strong> ${res.guestEmail || '______________________________'}</p>
                <h4>·Éí·Éê·Éú·Éó·Éê·Éï·É°·Éî·Éë·Éò·É° ·Éì·Éî·É¢·Éê·Éö·Éî·Éë·Éò</h4>
                <p><strong>·É©·Éî·É•·Éò·Éú·Éò·É° ·Éó·Éê·É†·Éò·É¶·Éò:</strong> ${checkinDisplay}</p>
                <p><strong>·É©·Éî·É•·Éê·É£·Éó·Éò·É° ·Éó·Éê·É†·Éò·É¶·Éò:</strong> ${checkoutDisplay}</p>
                <p><strong>·Éù·Éó·Éê·ÉÆ·Éò·É° ·Éú·Éù·Éõ·Éî·É†·Éò / ·É¢·Éò·Éû·Éò:</strong> ${room ? (room.roomName || room.roomNumber) : '-'} / ${room ? room.roomType : '-'}</p>
                <p><strong>·É°·É¢·É£·Éõ·É†·Éî·Éë·Éò·É° ·É†·Éê·Éù·Éì·Éî·Éú·Éù·Éë·Éê:</strong> ${res.numGuests || 1}</p>
                <h4>·Éó·Éê·Éú·ÉÆ·Éõ·Éù·Éë·Éê ·Éì·Éê ·É¨·Éî·É°·Éî·Éë·Éò·É° ·Éõ·Éò·É¶·Éî·Éë·Éê</h4>
                <p>·É•·Éï·Éî·Éõ·Éù·Éó ·ÉÆ·Éî·Éö·Éõ·Éù·É¨·Éî·É†·Éò·Éó ·Éï·Éê·Éì·Éê·É°·É¢·É£·É†·Éî·Éë, ·É†·Éù·Éõ:</p>
                <p>·Éõ·Éò·Éï·Éò·É¶·Éî ·Éì·Éê ·Éí·Éê·Éï·Éî·É™·Éê·Éú·Éò ·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·É° ·É®·Éò·Éì·Éê ·É¨·Éî·É°·Éî·Éë·É° ·Éì·Éê ·Éï·Éî·Éó·Éê·Éú·ÉÆ·Éõ·Éî·Éë·Éò ·Éõ·Éê·Éó ·Éì·Éê·É™·Éï·Éê·É°;</p>
                <p>·Éï·Éò·É¶·Éî·Éë ·Éû·Éê·É°·É£·ÉÆ·Éò·É°·Éõ·Éí·Éî·Éë·Éö·Éù·Éë·Éê·É° ·Éú·Éù·Éõ·Éî·É†·É®·Éò ·Éê·É†·É°·Éî·Éë·É£·Éö·Éò ·Éò·Éú·Éï·Éî·Éú·É¢·Éê·É†·Éò·É° ·Éì·Éê·Éñ·Éò·Éê·Éú·Éî·Éë·Éò·É° ·Éê·Éú ·Éì·Éê·Éô·Éê·É†·Éí·Éï·Éò·É° ·É®·Éî·Éõ·Éó·ÉÆ·Éï·Éî·Éï·Éê·É®·Éò;</p>
                <p>·Éï·Éî·Éó·Éê·Éú·ÉÆ·Éõ·Éî·Éë·Éò, ·É†·Éù·Éõ ·É°·Éê·É°·É¢·É£·Éõ·É†·Éù ·É£·É§·Éö·Éî·Éë·Éê·Éõ·Éù·É°·Éò·Éö·Éò·Éê ·Éì·Éê·Éê·Éõ·É£·É®·Éê·Éù·É° ·É©·Éî·Éõ·Éò ·Éû·Éî·É†·É°·Éù·Éú·Éê·Éö·É£·É†·Éò ·Éõ·Éù·Éú·Éê·É™·Éî·Éõ·Éî·Éë·Éò ·Éõ·ÉÆ·Éù·Éö·Éù·Éì ·Éõ·Éù·Éõ·É°·Éê·ÉÆ·É£·É†·Éî·Éë·Éò·É° ·Éí·Éê·É¨·Éî·Éï·Éò·É° ·Éõ·Éò·Éñ·Éú·Éò·Éó;</p>
                <p>·Éï·Éê·É™·Éú·Éù·Éë·Éò·Éî·É†·Éî·Éë, ·É†·Éù·Éõ ·É©·Éî·É•·Éê·É£·Éó·Éò·É° ·Éì·Éê·Éí·Éï·Éò·Éê·Éú·Éî·Éë·Éò·É° ·Éê·Éú ·É¨·Éî·É°·Éî·Éë·Éò·É° ·Éì·Éê·É†·É¶·Éï·Éî·Éï·Éò·É° ·É®·Éî·Éõ·Éó·ÉÆ·Éï·Éî·Éï·Éê·É®·Éò ·É®·Éî·É°·Éê·É´·Éö·Éù·Éê ·Éì·Éê·Éõ·Éî·Éô·Éò·É°·É†·Éù·É° ·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éò·Éó·Éò ·Éí·Éê·Éì·Éê·É°·Éê·ÉÆ·Éê·Éì·Éò.</p>
                <p>‚òê ·Éï·Éî·Éó·Éê·Éú·ÉÆ·Éõ·Éî·Éë·Éò ·Éñ·Éî·Éõ·Éù·Éó ·É©·Éê·Éõ·Éù·Éó·Éï·Éö·Éò·Éö ·Éû·Éò·É†·Éù·Éë·Éî·Éë·É°</p>
                <h4>·ÉÆ·Éî·Éö·Éõ·Éù·É¨·Éî·É†·Éê</h4>
                <p><strong>·É°·É¢·É£·Éõ·É†·Éò·É° ·ÉÆ·Éî·Éö·Éõ·Éù·É¨·Éî·É†·Éê:</strong> _________________________________</p>
                <p><strong>·Éó·Éê·É†·Éò·É¶·Éò:</strong> _____________________</p>
                <p><strong>·É°·Éê·É°·É¢·É£·Éõ·É†·Éù·É° ·É¨·Éê·É†·Éõ·Éù·Éõ·Éê·Éì·Éí·Éî·Éú·Éö·Éò·É° ·ÉÆ·Éî·Éö·Éõ·Éù·É¨·Éî·É†·Éê:</strong> __________________.</p>
            ` : `
                <p><strong>Hotel Name:</strong> ______________________________</p>
                <p><strong>Address:</strong> ________________________________________</p>
                <p><strong>Phone / Email:</strong> _______________________________</p>
                <h4>Guest Information</h4>
                <p><strong>Full Name:</strong> ${res.guestName || '___________________________________'}</p>
                <p><strong>ID / Passport No.:</strong> ${res.guestIdNumber || '______________________________'}</p>
                <p><strong>Citizenship:</strong> ${res.guestCitizenship || '______________________________'}</p>
                <p><strong>Date of Birth:</strong> ${birthDisplay || '______________________________'}</p>
                <p><strong>Phone Number:</strong> ${res.guestPhone || '______________________________'}</p>
                <p><strong>Email (optional):</strong> ${res.guestEmail || '______________________________'}</p>
                <h4>Accommodation Details</h4>
                <p><strong>Check-in Date:</strong> ${checkinDisplay}</p>
                <p><strong>Check-out Date:</strong> ${checkoutDisplay}</p>
                <p><strong>Room No. / Type:</strong> ${room ? (room.roomName || room.roomNumber) : '-'} / ${room ? room.roomType : '-'}</p>
                <p><strong>Number of Guests:</strong> ${res.numGuests || 1}</p>
                <h4>Consent and Rules</h4>
                <p>By signing below, I confirm that:</p>
                <p>I have received and read the hotel rules and agree to comply with them;</p>
                <p>I accept responsibility for any damage or loss of room inventory;</p>
                <p>I agree that the hotel may process my personal data solely for service purposes;</p>
                <p>I acknowledge that late checkout or rule violations may result in additional charges.</p>
                <p>‚òê I agree to the terms listed above</p>
                <h4>Signature</h4>
                <p><strong>Guest Signature:</strong> _________________________________</p>
                <p><strong>Date:</strong> _____________________</p>
                <p><strong>Hotel Representative Signature:</strong> __________________.</p>
            `;
            w.document.write(`
                <!DOCTYPE html>
                <html lang="${isKa ? 'ka' : 'en'}">
                <head>
                    <meta charset="UTF-8">
                    <title>${title}</title>
                    <style>
                        @page { size: A4; margin: 14mm; }
                        body { font-family: 'Roboto', sans-serif; padding: 0; color: #0f172a; font-size: 12px; }
                        .consent-form { padding: 14px; border: 1px solid #e2e8f0; }
                        h3 { text-align: center; margin-bottom: 10px; font-size: 16px; }
                        h4 { margin-top: 10px; margin-bottom: 6px; font-size: 13px; }
                        p { margin-bottom: 6px; line-height: 1.35; }
                        @media print { .no-print { display: none; } }
                    </style>
                </head>
                <body>
                    <div class="consent-form">
                        <h3>${title}</h3>
                        ${consentText}
                    </div>
                    <div class="no-print" style="margin-top: 16px;">
                        <button onclick="window.print()">${isKa ? '·Éë·Éî·É≠·Éì·Éï·Éê' : 'Print'}</button>
                    </div>
                </body>
                </html>
            `);
            w.document.close();
            w.focus();
        }

        function renderRooms() {
            const rooms = Storage.get('rooms', []);
            let html = `
                <div class="card">
                    <h2>·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò (${rooms.length} ·É™·Éê·Éö·Éò)</h2>
                    <div class="form-row mb-20">
                        <div class="form-group"><label>·Éù·Éó·Éê·ÉÆ·Éò·É° ·Éú·Éù·Éõ·Éî·É†·Éò *</label><input type="text" id="newRoomNumber"></div>
                        <div class="form-group"><label>·Éù·Éó·Éê·ÉÆ·Éò·É° ·É°·Éê·ÉÆ·Éî·Éö·Éò</label><input type="text" id="newRoomName"></div>
                        <div class="form-group"><label>·É¢·Éò·Éû·Éò</label>
                            <select id="newRoomType">
                                <option value="Single">Single</option>
                                <option value="Double">Double</option>
                                <option value="Triple">Triple</option>
                                <option value="Family">Family</option>
                                <option value="Suite">Suite</option>
                            </select>
                        </div>
                        <div class="form-group"><label>·É§·Éê·É°·Éò (‚Çæ)</label><input type="number" id="newRoomPrice" value="0" min="0" step="10"></div>
                        <div class="form-group"><label>·É°·É¢·Éê·É¢·É£·É°·Éò</label>
                            <select id="newRoomStatus">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                                <option value="Out of service">Out of service</option>
                            </select>
                        </div>
                        <div class="form-group"><label>·Éì·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éê</label>
                            <select id="newRoomCleaning">
                                <option value="Clean">Clean</option>
                                <option value="Dirty">Dirty</option>
                                <option value="In progress">In progress</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Extra Bed?</label>
                            <select id="newRoomExtra">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                        <div class="form-group"><label>Extra Bed ·É§·Éê·É°·Éò (‚Çæ)</label><input type="number" id="newRoomExtraPrice" value="0" min="0" step="5"></div>
                        <div class="form-group">
                            <label>&nbsp;</label>
                            <button class="btn btn-success btn-block" onclick="addRoom()">·Éù·Éó·Éê·ÉÆ·Éò·É° ·Éì·Éê·Éõ·Éê·É¢·Éî·Éë·Éê</button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead><tr><th>·Éú·Éù·Éõ·Éî·É†·Éò</th><th>·É°·Éê·ÉÆ·Éî·Éö·Éò</th><th>·É¢·Éò·Éû·Éò</th><th>·É§·Éê·É°·Éò</th><th>·É°·É¢·Éê·É¢·É£·É°·Éò</th><th>·Éì·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éê</th><th>Extra Bed</th><th>Extra Bed ·É§·Éê·É°·Éò</th><th>·É•·Éõ·Éî·Éì·Éî·Éë·Éê</th></tr></thead>
                            <tbody>
                                ${rooms.map(r => `
                                    <tr>
                                        <td><input type="text" id="roomNumber${r.id}" value="${r.roomNumber}"></td>
                                        <td><input type="text" id="roomName${r.id}" value="${r.roomName || ''}"></td>
                                        <td>
                                            <select id="roomType${r.id}">
                                                <option value="Single" ${r.roomType === 'Single' ? 'selected' : ''}>Single</option>
                                                <option value="Double" ${r.roomType === 'Double' ? 'selected' : ''}>Double</option>
                                                <option value="Triple" ${r.roomType === 'Triple' ? 'selected' : ''}>Triple</option>
                                                <option value="Family" ${r.roomType === 'Family' ? 'selected' : ''}>Family</option>
                                                <option value="Suite" ${r.roomType === 'Suite' ? 'selected' : ''}>Suite</option>
                                            </select>
                                        </td>
                                        <td><input type="number" id="roomPrice${r.id}" value="${r.basePrice}" min="0" step="10"></td>
                                        <td>
                                            <select id="roomStatus${r.id}">
                                                <option value="Active" ${r.status === 'Active' ? 'selected' : ''}>Active</option>
                                                <option value="Inactive" ${r.status === 'Inactive' ? 'selected' : ''}>Inactive</option>
                                                <option value="Out of service" ${r.status === 'Out of service' ? 'selected' : ''}>Out of service</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select id="roomCleaning${r.id}">
                                                <option value="Clean" ${r.cleaningStatus === 'Clean' ? 'selected' : ''}>Clean</option>
                                                <option value="Dirty" ${r.cleaningStatus === 'Dirty' ? 'selected' : ''}>Dirty</option>
                                                <option value="In progress" ${r.cleaningStatus === 'In progress' ? 'selected' : ''}>In progress</option>
                                            </select>
                                        </td>
                                        <td>
                                            <select id="roomExtra${r.id}">
                                                <option value="false" ${!r.extraBedAvailable ? 'selected' : ''}>No</option>
                                                <option value="true" ${r.extraBedAvailable ? 'selected' : ''}>Yes</option>
                                            </select>
                                        </td>
                                        <td><input type="number" id="roomExtraPrice${r.id}" value="${r.extraBedPrice || 0}" min="0" step="5"></td>
                                        <td><button class="btn btn-primary" onclick="saveRoom(${r.id})">·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê</button></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            document.getElementById('roomsPage').innerHTML = html;
        }

        function renderReports() {
            const reservations = Storage.get('reservations', []);
            const rooms = Storage.get('rooms', []);
            const totalRevenue = reservations.reduce((sum, r) => sum + getReservationFinancials(r.id).grossTotal, 0);
            const occupied = reservations.filter(r => r.status === 'Checked-in').length;

            let html = `
                <div class="card">
                    <h2>·Éõ·Éù·Éô·Éö·Éî ·Éê·Éú·Éí·Éê·É†·Éò·É®·Éò</h2>
                    <div class="stats-grid">
                        <div class="stat-card"><div class="label">üíµ ·É°·Éê·Éî·É†·Éó·Éù ·É®·Éî·Éõ·Éù·É°·Éê·Éï·Éê·Éö·Éò</div><div class="value">${totalRevenue}‚Çæ</div></div>
                        <div class="stat-card"><div class="label">üõè ·Éê·É•·É¢·Éò·É£·É†·Éò ·ÉØ·Éê·Éï·É®·Éú·Éî·Éë·Éò</div><div class="value">${reservations.length}</div></div>
                        <div class="stat-card"><div class="label">‚úÖ ·Éì·Éê·É°·Éê·ÉÆ·Éö·Éî·Éë·É£·Éö·Éò</div><div class="value">${occupied}</div></div>
                        <div class="stat-card"><div class="label">üè® ·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò</div><div class="value">${rooms.length}</div></div>
                    </div>
                </div>
            `;
            document.getElementById('reportsPage').innerHTML = html;
        }

        function formatDateTimeDisplay(dateValue) {
            if (!dateValue) return '-';
            const d = new Date(dateValue);
            if (Number.isNaN(d.getTime())) return '-';
            const day = String(d.getDate()).padStart(2, '0');
            const month = String(d.getMonth() + 1).padStart(2, '0');
            const year = d.getFullYear();
            const hour = String(d.getHours()).padStart(2, '0');
            const min = String(d.getMinutes()).padStart(2, '0');
            return `${day}/${month}/${year} ${hour}:${min}`;
        }
        function addChannelLog(success, message) {
            const logs = Storage.get('channelManagerLogs', []);
            logs.unshift({
                at: new Date().toISOString(),
                success: !!success,
                message
            });
            Storage.set('channelManagerLogs', logs.slice(0, 80));
        }
        let channelAutoSyncTimer = null;

        function getChannelManagerConfig() {
            const config = Storage.get('channelManagerConfig', {});
            return {
                provider: config.provider || CHANNEL_PROVIDER_NAME,
                apiBaseUrl: config.apiBaseUrl || CHANNEX_DEFAULT_BASE_URL,
                proxyUrl: config.proxyUrl || '',
                apiKey: config.apiKey || '',
                propertyId: config.propertyId || '',
                isConnected: !!config.isConnected,
                connectedAt: config.connectedAt || '',
                lastSyncAt: config.lastSyncAt || '',
                autoSyncEnabled: !!config.autoSyncEnabled,
                syncIntervalMinutes: Number(config.syncIntervalMinutes) || 15
            };
        }
        function saveChannelManagerConfig(config) {
            Storage.set('channelManagerConfig', { ...getChannelManagerConfig(), ...config });
        }
        function restartChannelAutoSync() {
            if (channelAutoSyncTimer) {
                clearInterval(channelAutoSyncTimer);
                channelAutoSyncTimer = null;
            }
            const cfg = getChannelManagerConfig();
            const intervalMs = Math.max(5, cfg.syncIntervalMinutes || 15) * 60 * 1000;
            if (cfg.autoSyncEnabled && cfg.isConnected) {
                channelAutoSyncTimer = setInterval(() => {
                    syncChannexData('rates', { silent: true, fromAuto: true });
                    syncChannexData('reservations', { silent: true, fromAuto: true });
                }, intervalMs);
            }
        }
        function readChannelForm() {
            return {
                apiBaseUrl: document.getElementById('channelApiBaseUrl').value.trim(),
                proxyUrl: document.getElementById('channelProxyUrl').value.trim(),
                apiKey: document.getElementById('channelApiKey').value.trim(),
                propertyId: document.getElementById('channelPropertyId').value.trim(),
                autoSyncEnabled: document.getElementById('channelAutoSync').checked,
                syncIntervalMinutes: parseInt(document.getElementById('channelSyncInterval').value, 10) || 15
            };
        }
        async function channexRequest(path, method = 'GET', body = null) {
            const cfg = getChannelManagerConfig();
            if (!cfg.apiKey) throw new Error('API key ·É°·Éê·Éï·Éê·Éö·Éì·Éî·Éë·É£·Éö·Éù·Éê');
            const base = (cfg.proxyUrl || cfg.apiBaseUrl || '').replace(/\/$/, '');
            if (!base) throw new Error('API URL ·É™·Éê·É†·Éò·Éî·Éö·Éò·Éê');
            const url = `${base}${path}`;
            const options = {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    Authorization: `Bearer ${cfg.apiKey}`
                }
            };
            if (body) options.body = JSON.stringify(body);
            const response = await fetch(url, options);
            const text = await response.text();
            let data = {};
            try { data = text ? JSON.parse(text) : {}; } catch (e) { data = { raw: text }; }
            if (!response.ok) {
                const message = data?.errors?.[0]?.detail || data?.message || `${response.status} ${response.statusText}`;
                throw new Error(message);
            }
            return data;
        }
        function saveChannexSettings() {
            const form = readChannelForm();
            if (!form.apiBaseUrl && !form.proxyUrl) {
                showAlert('channelManagerAlert', '·Éõ·Éò·É£·Éó·Éò·Éó·Éî·Éó API Base URL ·Éê·Éú Proxy URL', 'error');
                return;
            }
            saveChannelManagerConfig(form);
            addChannelLog(true, 'Channel Manager ·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò ·É®·Éî·Éú·Éê·ÉÆ·É£·Éö·Éò·Éê');
            showAlert('channelManagerAlert', 'Channel Manager ·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò ·É®·Éî·Éú·Éê·ÉÆ·É£·Éö·Éò·Éê', 'success');
            restartChannelAutoSync();
            renderSettings();
        }
        async function testChannexConnection() {
            const form = readChannelForm();
            saveChannelManagerConfig(form);
            try {
                const data = await channexRequest('/properties?pagination[limit]=1');
                const propId = form.propertyId || data?.data?.[0]?.id || '';
                saveChannelManagerConfig({
                    isConnected: true,
                    connectedAt: new Date().toISOString(),
                    propertyId: propId
                });
                restartChannelAutoSync();
                addChannelLog(true, 'Channex ·Éô·Éê·Éï·É®·Éò·É†·Éò ·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·Éò·Éó ·Éì·Éê·Éì·Éê·É°·É¢·É£·É†·Éì·Éê');
                showAlert('channelManagerAlert', '·Éô·Éê·Éï·É®·Éò·É†·Éò ·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·É£·Éö·Éò·Éê', 'success');
            } catch (e) {
                saveChannelManagerConfig({ isConnected: false });
                restartChannelAutoSync();
                addChannelLog(false, `·Éô·Éê·Éï·É®·Éò·É†·Éò·É° ·É®·Éî·É™·Éì·Éù·Éõ·Éê: ${e.message}`);
                showAlert('channelManagerAlert', `·Éô·Éê·Éï·É®·Éò·É†·Éò·É° ·É®·Éî·É™·Éì·Éù·Éõ·Éê: ${e.message}`, 'error');
            }
            renderSettings();
        }
        async function syncChannexData(syncType, options = {}) {
            const cfg = getChannelManagerConfig();
            if (!cfg.isConnected) {
                if (!options.silent) showAlert('channelManagerAlert', '·ÉØ·Éî·É† ·Éì·Éê·Éê·Éô·Éê·Éï·É®·Éò·É†·Éî·Éó Channex', 'error');
                return;
            }
            if (!cfg.propertyId) {
                if (!options.silent) showAlert('channelManagerAlert', 'Property ID ·Éê·É† ·Éê·É†·Éò·É° ·Éõ·Éò·Éó·Éò·Éó·Éî·Éë·É£·Éö·Éò', 'error');
                return;
            }
            try {
                if (syncType === 'rates') {
                    await channexRequest(`/room_types?filter[property_id]=${encodeURIComponent(cfg.propertyId)}&pagination[limit]=5`);
                    await channexRequest(`/rate_plans?filter[property_id]=${encodeURIComponent(cfg.propertyId)}&pagination[limit]=5`);
                    addChannelLog(true, options.fromAuto ? 'Auto: Rates & Inventory sync ·É®·Éî·É°·É†·É£·Éö·Éì·Éê' : 'Rates & Inventory sync ·É®·Éî·É°·É†·É£·Éö·Éì·Éê');
                    if (!options.silent) showAlert('channelManagerAlert', 'Rates & Inventory sync ·Éì·Éê·É°·É†·É£·Éö·Éì·Éê', 'success');
                } else {
                    await channexRequest(`/bookings?filter[property_id]=${encodeURIComponent(cfg.propertyId)}&pagination[limit]=20`);
                    addChannelLog(true, options.fromAuto ? 'Auto: Reservations sync ·É®·Éî·É°·É†·É£·Éö·Éì·Éê' : 'Reservations sync ·É®·Éî·É°·É†·É£·Éö·Éì·Éê');
                    if (!options.silent) showAlert('channelManagerAlert', 'Reservations sync ·Éì·Éê·É°·É†·É£·Éö·Éì·Éê', 'success');
                }
                saveChannelManagerConfig({ lastSyncAt: new Date().toISOString() });
            } catch (e) {
                addChannelLog(false, `${options.fromAuto ? 'Auto: ' : ''}Sync ·É®·Éî·É™·Éì·Éù·Éõ·Éê: ${e.message}`);
                if (!options.silent) showAlert('channelManagerAlert', `Sync ·É®·Éî·É™·Éì·Éù·Éõ·Éê: ${e.message}`, 'error');
            }
            if (!options.silent) renderSettings();
        }
        function disconnectChannex() {
            const cfg = getChannelManagerConfig();
            saveChannelManagerConfig({
                ...cfg,
                apiKey: '',
                isConnected: false,
                connectedAt: '',
                lastSyncAt: ''
            });
            restartChannelAutoSync();
            addChannelLog(true, 'Channex ·Éí·Éê·Éó·Éò·É®·É£·Éö·Éò·Éê');
            showAlert('channelManagerAlert', 'Channex ·Éô·Éê·Éï·É®·Éò·É†·Éò ·Éí·Éê·Éó·Éò·É®·É£·Éö·Éò·Éê', 'warning');
            renderSettings();
        }

        function renderSettings() {
            const monthlyRates = Storage.get('monthlyRates', getDefaultMonthlyRates());
            const months = ['·Éò·Éê·Éú', '·Éó·Éî·Éë', '·Éõ·Éê·É†', '·Éê·Éû·É†', '·Éõ·Éê·Éò', '·Éò·Éï·Éú', '·Éò·Éï·Éö', '·Éê·Éí·Éï', '·É°·Éî·É•', '·Éù·É•·É¢', '·Éú·Éù·Éî', '·Éì·Éî·Éô'];
            const channelConfig = getChannelManagerConfig();
            const channelLogs = Storage.get('channelManagerLogs', []);
            const html = `
                <div class="card">
                    <h2>·Éû·Éê·É†·Éê·Éõ·Éî·É¢·É†·Éî·Éë·Éò</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>·Éõ·Éò·Éõ·Éì·Éò·Éú·Éê·É†·Éî ·Éû·Éê·É†·Éù·Éö·Éò</label>
                            <input type="password" id="currentPassword">
                        </div>
                        <div class="form-group">
                            <label>·Éê·ÉÆ·Éê·Éö·Éò ·Éû·Éê·É†·Éù·Éö·Éò</label>
                            <input type="password" id="newPassword">
                        </div>
                        <div class="form-group">
                            <label>·Éí·Éê·Éò·Éõ·Éî·Éù·É†·Éî ·Éê·ÉÆ·Éê·Éö·Éò ·Éû·Éê·É†·Éù·Éö·Éò</label>
                            <input type="password" id="confirmPassword">
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="changePassword()">·Éû·Éê·É†·Éù·Éö·Éò·É° ·É®·Éî·É™·Éï·Éö·Éê</button>
                    </div>
                    <div id="settingsAlert"></div>
                </div>
                <div class="card">
                    <h2>·É§·Éê·É°·Éî·Éë·Éò</h2>
                    <div class="alert alert-info">·Éù·Éó·Éê·ÉÆ·Éò·É° ·É§·Éê·É°·Éî·Éë·Éò·É° ·Éõ·Éê·É†·Éó·Éï·Éê ·Éó·Éï·Éî·Éî·Éë·Éò·É° ·Éõ·Éò·ÉÆ·Éî·Éì·Éï·Éò·Éó</div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>·Éó·Éï·Éî</th>
                                    <th>Single</th>
                                    <th>Double</th>
                                    <th>Triple</th>
                                    <th>Family</th>
                                    <th>Suite</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${months.map((m, i) => {
                                    const idx = i + 1;
                                    const row = monthlyRates[idx] || {};
                                    return `
                                        <tr>
                                            <td>${m}</td>
                                            <td><input type="number" id="rate_${idx}_Single" value="${row.Single ?? 0}" min="0" step="10"></td>
                                            <td><input type="number" id="rate_${idx}_Double" value="${row.Double ?? 0}" min="0" step="10"></td>
                                            <td><input type="number" id="rate_${idx}_Triple" value="${row.Triple ?? 0}" min="0" step="10"></td>
                                            <td><input type="number" id="rate_${idx}_Family" value="${row.Family ?? 0}" min="0" step="10"></td>
                                            <td><input type="number" id="rate_${idx}_Suite" value="${row.Suite ?? 0}" min="0" step="10"></td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="saveMonthlyRates()">·É§·Éê·É°·Éî·Éë·Éò·É° ·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê</button>
                    </div>
                </div>
                <div class="card">
                    <h2>Channel Manager (${CHANNEL_PROVIDER_NAME})</h2>
                    <div class="channel-status ${channelConfig.isConnected ? 'connected' : 'disconnected'}">
                        <span>${channelConfig.isConnected ? '‚óè Connected' : '‚óè Disconnected'}</span>
                        <span>·Éë·Éù·Éö·Éù sync: ${formatDateTimeDisplay(channelConfig.lastSyncAt)}</span>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>API Base URL</label>
                            <input type="text" id="channelApiBaseUrl" value="${channelConfig.apiBaseUrl}" placeholder="https://staging.channex.io/api/v1">
                        </div>
                        <div class="form-group">
                            <label>Proxy URL (·É†·Éî·Éô·Éù·Éõ·Éî·Éú·Éì·Éî·Éë·É£·Éö·Éò·Éê)</label>
                            <input type="text" id="channelProxyUrl" value="${channelConfig.proxyUrl}" placeholder="https://your-backend.com/channex-proxy">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>API Key</label>
                            <input type="password" id="channelApiKey" value="${channelConfig.apiKey}" placeholder="ck_live_xxx ·Éê·Éú ck_test_xxx">
                        </div>
                        <div class="form-group">
                            <label>Property ID</label>
                            <input type="text" id="channelPropertyId" value="${channelConfig.propertyId}" placeholder="Channex Property ID">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Auto Sync</label>
                            <select id="channelSyncInterval">
                                <option value="5" ${channelConfig.syncIntervalMinutes === 5 ? 'selected' : ''}>·Éß·Éù·Éï·Éî·Éö 5 ·É¨·É£·Éó·É®·Éò</option>
                                <option value="15" ${channelConfig.syncIntervalMinutes === 15 ? 'selected' : ''}>·Éß·Éù·Éï·Éî·Éö 15 ·É¨·É£·Éó·É®·Éò</option>
                                <option value="30" ${channelConfig.syncIntervalMinutes === 30 ? 'selected' : ''}>·Éß·Éù·Éï·Éî·Éö 30 ·É¨·É£·Éó·É®·Éò</option>
                                <option value="60" ${channelConfig.syncIntervalMinutes === 60 ? 'selected' : ''}>·Éß·Éù·Éï·Éî·Éö 60 ·É¨·É£·Éó·É®·Éò</option>
                            </select>
                        </div>
                        <div class="form-group" style="display:flex; align-items:center; gap:10px; padding-top:35px;">
                            <input type="checkbox" id="channelAutoSync" ${channelConfig.autoSyncEnabled ? 'checked' : ''}>
                            <label for="channelAutoSync" style="margin:0;">Auto sync ·É©·Éê·É†·Éó·É£·Éö·Éò·Éê</label>
                        </div>
                    </div>
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="saveChannexSettings()">·É®·Éî·Éú·Éê·ÉÆ·Éï·Éê</button>
                        <button class="btn btn-success" onclick="testChannexConnection()">·Éì·Éê·Éô·Éê·Éï·É®·Éò·É†·Éî·Éë·Éò·É° ·É¢·Éî·É°·É¢·Éò</button>
                        <button class="btn btn-warning" onclick="syncChannexData('rates')">Rates/Inventory Sync</button>
                        <button class="btn btn-warning" onclick="syncChannexData('reservations')">Reservations Sync</button>
                        <button class="btn btn-danger" onclick="disconnectChannex()">·Éí·Éê·Éó·Éò·É®·Éï·Éê</button>
                    </div>
                    <div id="channelManagerAlert"></div>
                    <div class="mt-20">
                        <h3>·Éö·Éù·Éí·Éî·Éë·Éò</h3>
                        <div class="channel-log-box">
                            ${channelLogs.length ? channelLogs.slice(0, 20).map(item => `
                                <div class="channel-log-item">
                                    <span class="time">${formatDateTimeDisplay(item.at)}</span>
                                    <span class="${item.success ? 'ok' : 'fail'}">${item.success ? 'OK' : 'ERROR'}</span>
                                    <span>${item.message || '-'}</span>
                                </div>
                            `).join('') : '<div class="channel-log-item"><span>·Éö·Éù·Éí·Éî·Éë·Éò ·ÉØ·Éî·É† ·Éê·É† ·Éê·É†·Éò·É°</span></div>'}
                        </div>
                    </div>
                </div>
            `;
            document.getElementById('settingsPage').innerHTML = html;
        }
        function renderCheckInOut() {
            const html = `
                <div class="card">
                    <h2>Check‚Äëin / Check‚Äëout</h2>
                    <div class="alert alert-info">·Éê·Éõ ·Éí·Éï·Éî·É†·Éì·Éñ·Éî ·É®·Éî·Éí·Éò·É´·Éö·Éò·Éê·Éó ·É°·É¨·É†·Éê·É§·Éò ·É©·Éî·É•·Éò·Éú/·É©·Éî·É•·Éê·É£·Éó ·Éù·Éû·Éî·É†·Éê·É™·Éò·Éî·Éë·Éò ·Éì·Éê·Éê·Éõ·Éê·É¢·Éù·Éó.</div>
                </div>
            `;
            document.getElementById('checkinoutPage').innerHTML = html;
        }
        function renderPayments() {
            const html = `
                <div class="card">
                    <h2>·Éí·Éê·Éì·Éê·ÉÆ·Éì·Éî·Éë·Éò</h2>
                    <div class="alert alert-info">·Éí·Éê·Éì·Éê·ÉÆ·Éì·Éî·Éë·Éò·É° ·Éò·É°·É¢·Éù·É†·Éò·Éê ·Éì·Éê ·É°·É¢·Éê·É¢·É£·É°·Éî·Éë·Éò.</div>
                </div>
            `;
            document.getElementById('paymentsPage').innerHTML = html;
        }
        function renderStaff() {
            const html = `
                <div class="card">
                    <h2>·Éû·Éî·É†·É°·Éù·Éú·Éê·Éö·Éò</h2>
                    <div class="alert alert-info">·Éû·Éî·É†·É°·Éù·Éú·Éê·Éö·Éò·É° ·Éõ·Éê·É†·Éó·Éï·Éò·É° ·Éí·Éï·Éî·É†·Éì·Éò.</div>
                </div>
            `;
            document.getElementById('staffPage').innerHTML = html;
        }
        function renderHousekeeping() {
            const html = `
                <div class="card">
                    <h2>Housekeeping</h2>
                    <div class="alert alert-info">·Éù·Éó·Éê·ÉÆ·Éî·Éë·Éò·É° ·Éì·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éò·É° ·É°·É¢·Éê·É¢·É£·É°·Éî·Éë·Éò.</div>
                </div>
            `;
            document.getElementById('housekeepingPage').innerHTML = html;
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) modal.classList.remove('active');
        }
        function addRoom() {
            const roomNumber = document.getElementById('newRoomNumber').value.trim();
            const roomName = document.getElementById('newRoomName').value.trim();
            const roomType = document.getElementById('newRoomType').value;
            const basePrice = parseFloat(document.getElementById('newRoomPrice').value) || 0;
            const status = document.getElementById('newRoomStatus').value;
            const cleaningStatus = document.getElementById('newRoomCleaning').value;
            const extraBedAvailable = document.getElementById('newRoomExtra').value === 'true';
            const extraBedPrice = parseFloat(document.getElementById('newRoomExtraPrice').value) || 0;

            if (!roomNumber) {
                alert('·Éù·Éó·Éê·ÉÆ·Éò·É° ·Éú·Éù·Éõ·Éî·É†·Éò ·Éê·É£·É™·Éò·Éö·Éî·Éë·Éî·Éö·Éò·Éê!');
                return;
            }
            const rooms = Storage.get('rooms', []);
            const nextId = rooms.length ? Math.max(...rooms.map(r => r.id)) + 1 : 1;
            rooms.push({
                id: nextId,
                roomNumber,
                roomName: roomName || `Room ${roomNumber}`,
                roomType,
                basePrice,
                status,
                cleaningStatus,
                extraBedAvailable,
                extraBedPrice
            });
            Storage.set('rooms', rooms);
            renderRooms();
            renderCalendar();
        }
        function saveRoom(roomId) {
            const rooms = Storage.get('rooms', []);
            const idx = rooms.findIndex(r => r.id === roomId);
            if (idx === -1) return;

            const roomNumber = document.getElementById(`roomNumber${roomId}`).value.trim();
            const roomName = document.getElementById(`roomName${roomId}`).value.trim();
            const roomType = document.getElementById(`roomType${roomId}`).value;
            const basePrice = parseFloat(document.getElementById(`roomPrice${roomId}`).value) || 0;
            const status = document.getElementById(`roomStatus${roomId}`).value;
            const cleaningStatus = document.getElementById(`roomCleaning${roomId}`).value;
            const extraBedAvailable = document.getElementById(`roomExtra${roomId}`).value === 'true';
            const extraBedPrice = parseFloat(document.getElementById(`roomExtraPrice${roomId}`).value) || 0;

            if (!roomNumber) {
                alert('·Éù·Éó·Éê·ÉÆ·Éò·É° ·Éú·Éù·Éõ·Éî·É†·Éò ·Éê·É£·É™·Éò·Éö·Éî·Éë·Éî·Éö·Éò·Éê!');
                return;
            }

            rooms[idx] = {
                ...rooms[idx],
                roomNumber,
                roomName: roomName || `Room ${roomNumber}`,
                roomType,
                basePrice,
                status,
                cleaningStatus,
                extraBedAvailable,
                extraBedPrice
            };
            Storage.set('rooms', rooms);
            renderRooms();
            renderCalendar();
        }
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const currentUser = Storage.get('currentUser');
            const users = Storage.get('users', []);
            const userIndex = users.findIndex(u => u.username === currentUser);
            if (userIndex === -1) {
                showAlert('settingsAlert', '·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò ·Éï·Éî·É† ·Éõ·Éù·Éò·É´·Éî·Éë·Éú·Éê', 'error');
                return;
            }
            if (users[userIndex].password !== currentPassword) {
                showAlert('settingsAlert', '·Éõ·Éò·Éõ·Éì·Éò·Éú·Éê·É†·Éî ·Éû·Éê·É†·Éù·Éö·Éò ·Éê·É†·Éê·É°·É¨·Éù·É†·Éò·Éê', 'error');
                return;
            }
            if (!newPassword || newPassword.length < 4) {
                showAlert('settingsAlert', '·Éê·ÉÆ·Éê·Éö·Éò ·Éû·Éê·É†·Éù·Éö·Éò ·Éõ·Éò·Éú. 4 ·É°·Éò·Éõ·Éë·Éù·Éö·Éù', 'error');
                return;
            }
            if (newPassword !== confirmPassword) {
                showAlert('settingsAlert', '·Éû·Éê·É†·Éù·Éö·Éî·Éë·Éò ·Éê·É† ·Éî·Éõ·Éó·ÉÆ·Éï·Éî·Éï·Éê', 'error');
                return;
            }
            users[userIndex].password = newPassword;
            Storage.set('users', users);
            showAlert('settingsAlert', '·Éû·Éê·É†·Éù·Éö·Éò ·É¨·Éê·É†·Éõ·Éê·É¢·Éî·Éë·Éò·Éó ·É®·Éî·Éò·É™·Éï·Éê·Éö·Éê', 'success');
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        function saveMonthlyRates() {
            const rates = {};
            for (let m = 1; m <= 12; m++) {
                rates[m] = {
                    Single: parseFloat(document.getElementById(`rate_${m}_Single`).value) || 0,
                    Double: parseFloat(document.getElementById(`rate_${m}_Double`).value) || 0,
                    Triple: parseFloat(document.getElementById(`rate_${m}_Triple`).value) || 0,
                    Family: parseFloat(document.getElementById(`rate_${m}_Family`).value) || 0,
                    Suite: parseFloat(document.getElementById(`rate_${m}_Suite`).value) || 0
                };
            }
            Storage.set('monthlyRates', rates);
            showAlert('settingsAlert', '·É§·Éê·É°·Éî·Éë·Éò ·É®·Éî·Éú·Éê·ÉÆ·É£·Éö·Éò·Éê', 'success');
        }

        window.addEventListener('load', () => {
            initializeApp();
            const currentUser = Storage.get('currentUser');
            if (currentUser) {
                document.getElementById('loginContainer').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                document.getElementById('currentUser').textContent = `·Éõ·Éù·Éõ·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éî·Éö·Éò: ${currentUser}`;
                showPage('dashboard');
            }
        });
    </script>
</body>
</html>
